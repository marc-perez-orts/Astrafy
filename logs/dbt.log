[0m23:09:21.390236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEDF8FB970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEE1BA5400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEE1BA5190>]}


============================== 23:09:21.395223 | 6f640f1b-ee67-41de-babb-01f27c7a50dc ==============================
[0m23:09:21.395223 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:09:21.398374 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'empty': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m23:09:26.977552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f640f1b-ee67-41de-babb-01f27c7a50dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEF4BB1640>]}
[0m23:09:27.135292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f640f1b-ee67-41de-babb-01f27c7a50dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEE1942E20>]}
[0m23:09:27.137047 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m23:09:28.951633 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:09:28.953157 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:09:28.958163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6f640f1b-ee67-41de-babb-01f27c7a50dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEF4D93370>]}
[0m23:09:34.133304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6f640f1b-ee67-41de-babb-01f27c7a50dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEF55CF130>]}
[0m23:09:34.410147 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m23:09:34.418118 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m23:09:34.517092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6f640f1b-ee67-41de-babb-01f27c7a50dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEF55E21C0>]}
[0m23:09:34.517378 [info ] [MainThread]: Found 2 models, 4 data tests, 508 macros
[0m23:09:34.522957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f640f1b-ee67-41de-babb-01f27c7a50dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEF55D0310>]}
[0m23:09:34.526947 [info ] [MainThread]: 
[0m23:09:34.527945 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:09:34.530937 [info ] [MainThread]: 
[0m23:09:34.532934 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:09:34.563081 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m23:09:34.566072 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:09:35.110967 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2, now create_sage-tribute-474816-g2_Astrafy)
[0m23:09:35.113395 [debug] [ThreadPool]: Creating schema "database: "sage-tribute-474816-g2"
schema: "Astrafy"
"
[0m23:09:35.142201 [debug] [ThreadPool]: On create_sage-tribute-474816-g2_Astrafy: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "connection_name": "create_sage-tribute-474816-g2_Astrafy"} */
create schema if not exists `sage-tribute-474816-g2`.`Astrafy`
  
[0m23:09:35.144196 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:09:35.835461 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:f89a5fea-643f-410f-911f-9e79004b1ecd&page=queryresults
[0m23:09:38.977940 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy'
[0m23:09:38.978938 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:09:39.597444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f640f1b-ee67-41de-babb-01f27c7a50dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEDDF597F0>]}
[0m23:09:39.599061 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:09:39.621926 [debug] [Thread-1  ]: Began running node model.Astrafy.my_first_dbt_model
[0m23:09:39.622924 [info ] [Thread-1  ]: 1 of 2 START sql table model Astrafy.my_first_dbt_model ........................ [RUN]
[0m23:09:39.624917 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.my_first_dbt_model'
[0m23:09:39.625915 [debug] [Thread-1  ]: Began compiling node model.Astrafy.my_first_dbt_model
[0m23:09:39.649850 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.my_first_dbt_model"
[0m23:09:39.654837 [debug] [Thread-1  ]: Began executing node model.Astrafy.my_first_dbt_model
[0m23:09:39.770116 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.my_first_dbt_model"
[0m23:09:39.777447 [debug] [Thread-1  ]: On model.Astrafy.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.my_first_dbt_model"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
      
    
    

    
    OPTIONS()
    as (
      /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
    );
  
[0m23:09:39.777447 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:09:41.083463 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:c2b3124f-5419-4368-9300-3181089391a7&page=queryresults
[0m23:09:42.957680 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f640f1b-ee67-41de-babb-01f27c7a50dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEF5452520>]}
[0m23:09:42.958675 [info ] [Thread-1  ]: 1 of 2 OK created sql table model Astrafy.my_first_dbt_model ................... [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 3.32s]
[0m23:09:42.961668 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_first_dbt_model
[0m23:09:42.962969 [debug] [Thread-1  ]: Began running node model.Astrafy.my_second_dbt_model
[0m23:09:42.962969 [info ] [Thread-1  ]: 2 of 2 START sql view model Astrafy.my_second_dbt_model ........................ [RUN]
[0m23:09:42.971091 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.my_first_dbt_model, now model.Astrafy.my_second_dbt_model)
[0m23:09:42.976077 [debug] [Thread-1  ]: Began compiling node model.Astrafy.my_second_dbt_model
[0m23:09:42.986051 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.my_second_dbt_model"
[0m23:09:42.995027 [debug] [Thread-1  ]: Began executing node model.Astrafy.my_second_dbt_model
[0m23:09:43.077068 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.my_second_dbt_model"
[0m23:09:43.083046 [debug] [Thread-1  ]: On model.Astrafy.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.my_second_dbt_model"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy`.`my_second_dbt_model`
  OPTIONS()
  as -- Use the `ref` function to select from other models

select *
from `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
where id = 1;


[0m23:09:43.085040 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m23:09:44.149565 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:749118d4-fab8-4dc7-a405-4dc4f6d0c30b&page=queryresults
[0m23:09:44.596694 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f640f1b-ee67-41de-babb-01f27c7a50dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEF4D799A0>]}
[0m23:09:44.598690 [info ] [Thread-1  ]: 2 of 2 OK created sql view model Astrafy.my_second_dbt_model ................... [[32mCREATE VIEW (0 processed)[0m in 1.63s]
[0m23:09:44.601254 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_second_dbt_model
[0m23:09:44.605761 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:09:44.610780 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:09:44.611775 [debug] [MainThread]: Connection 'create_sage-tribute-474816-g2_Astrafy' was properly closed.
[0m23:09:44.612741 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy' was properly closed.
[0m23:09:44.614735 [debug] [MainThread]: Connection 'model.Astrafy.my_second_dbt_model' was properly closed.
[0m23:09:44.615758 [info ] [MainThread]: 
[0m23:09:44.618728 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 10.08 seconds (10.08s).
[0m23:09:44.631692 [debug] [MainThread]: Command end result
[0m23:09:44.732962 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m23:09:44.746563 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m23:09:44.767086 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m23:09:44.768083 [info ] [MainThread]: 
[0m23:09:44.770079 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:09:44.772075 [info ] [MainThread]: 
[0m23:09:44.776063 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:09:44.781050 [debug] [MainThread]: Command `dbt run` succeeded at 23:09:44.781050 after 23.53 seconds
[0m23:09:44.784041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEDF8FB970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEF566A2B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEF566A640>]}
[0m23:09:44.786037 [debug] [MainThread]: Flushing usage events
[0m23:09:45.293169 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:28:58.061953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002577604B9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257782F5460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257782F51F0>]}


============================== 18:28:58.195529 | d1b095da-f653-4f9d-a5ec-d968984693a5 ==============================
[0m18:28:58.195529 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m18:28:58.195529 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'partial_parse': 'True', 'quiet': 'False', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'invocation_command': 'dbt init astrafy_challenge', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'None', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m18:28:58.532505 [info ] [MainThread]: Setting up your profile.
[0m18:28:58.548303 [debug] [MainThread]: Command `dbt init` succeeded at 18:28:58.548303 after 0.78 seconds
[0m18:28:58.548303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002577604B9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257782F5160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257782DCD60>]}
[0m18:28:58.548303 [debug] [MainThread]: Flushing usage events
[0m18:28:59.264575 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:29:35.090252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002340735B970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023409605430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234096051C0>]}


============================== 18:29:35.090252 | 52f43840-3261-45db-b149-47abc317cf2d ==============================
[0m18:29:35.090252 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m18:29:35.105873 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'invocation_command': 'dbt init astrafy_challenge', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'None', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m18:29:35.137796 [info ] [MainThread]: Setting up your profile.
[0m18:33:47.910458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000181B22BB9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000181B4564460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000181B45641F0>]}


============================== 18:33:47.915742 | 374c098f-4387-48a8-bf12-1ee1ab454f79 ==============================
[0m18:33:47.915742 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m18:33:47.917714 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'partial_parse': 'True', 'invocation_command': 'dbt init astrafy_challenge', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'None', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m18:33:47.952048 [info ] [MainThread]: Setting up your profile.
[0m18:33:47.960028 [debug] [MainThread]: Command `dbt init` succeeded at 18:33:47.960028 after 0.19 seconds
[0m18:33:47.962023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000181B22BB9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000181B4564160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000181B454CD60>]}
[0m18:33:47.964273 [debug] [MainThread]: Flushing usage events
[0m18:33:48.515749 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:42:26.616231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A05DCAB970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A05FF562E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A05FF56070>]}


============================== 18:42:26.622010 | 53751a15-8a4f-4da1-8ebc-00616681cf14 ==============================
[0m18:42:26.622010 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m18:42:26.624378 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'quiet': 'False', 'partial_parse': 'True', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'invocation_command': 'dbt run --select staging', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m18:42:31.026388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53751a15-8a4f-4da1-8ebc-00616681cf14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A073075A60>]}
[0m18:42:31.120112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '53751a15-8a4f-4da1-8ebc-00616681cf14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A072F31F70>]}
[0m18:42:31.135730 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m18:42:32.402459 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m18:42:33.964673 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 3 files added, 0 files changed.
[0m18:42:33.965670 [debug] [MainThread]: Partial parsing: added file: Astrafy://models\staging\schema.yml
[0m18:42:33.966668 [debug] [MainThread]: Partial parsing: added file: Astrafy://models\staging\stg_orders.sql
[0m18:42:33.968105 [debug] [MainThread]: Partial parsing: added file: Astrafy://models\staging\stg_sales.sql
[0m18:42:34.804053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '53751a15-8a4f-4da1-8ebc-00616681cf14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0739E4130>]}
[0m18:42:35.008369 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m18:42:35.023623 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m18:42:35.091493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '53751a15-8a4f-4da1-8ebc-00616681cf14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0735E39D0>]}
[0m18:42:35.092455 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 508 macros
[0m18:42:35.093726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53751a15-8a4f-4da1-8ebc-00616681cf14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0730DECA0>]}
[0m18:42:35.098697 [info ] [MainThread]: 
[0m18:42:35.103022 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:42:35.104021 [info ] [MainThread]: 
[0m18:42:35.106141 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:42:35.124960 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m18:42:35.125990 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:42:35.919532 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy'
[0m18:42:35.932064 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:42:36.565365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53751a15-8a4f-4da1-8ebc-00616681cf14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A07361B1C0>]}
[0m18:42:36.565365 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:42:36.605077 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_orders
[0m18:42:36.607077 [info ] [Thread-1  ]: 1 of 2 START sql view model Astrafy.stg_orders ................................. [RUN]
[0m18:42:36.609071 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.stg_orders'
[0m18:42:36.610097 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_orders
[0m18:42:36.759833 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_orders"
[0m18:42:36.775456 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_orders
[0m18:42:36.813508 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_orders"
[0m18:42:36.829161 [debug] [Thread-1  ]: On model.Astrafy.stg_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_orders"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy`.`stg_orders`
  OPTIONS()
  as 

-- Clean and normalize the orders table
select
  date_date,
  cast(customers_id as int64) as customer_id,
  cast(orders_id as int64) as order_id,
  cast(net_sales as float64) as net_sales
from `sage-tribute-474816-g2`.`Astrafy`.`orders_recrutement`
where date_date is not null;


[0m18:42:36.829161 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m18:42:37.740974 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:5cb10fc6-d5b0-4e04-a726-5908f48b271d&page=queryresults
[0m18:42:41.146793 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53751a15-8a4f-4da1-8ebc-00616681cf14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A05FFC3550>]}
[0m18:42:41.162412 [info ] [Thread-1  ]: 1 of 2 OK created sql view model Astrafy.stg_orders ............................ [[32mCREATE VIEW (0 processed)[0m in 4.54s]
[0m18:42:41.162412 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_orders
[0m18:42:41.162412 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_sales
[0m18:42:41.162412 [info ] [Thread-1  ]: 2 of 2 START sql view model Astrafy.stg_sales .................................. [RUN]
[0m18:42:41.173414 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_orders, now model.Astrafy.stg_sales)
[0m18:42:41.174415 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_sales
[0m18:42:41.186874 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_sales"
[0m18:42:41.186874 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_sales
[0m18:42:41.186874 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_sales"
[0m18:42:41.204826 [debug] [Thread-1  ]: On model.Astrafy.stg_sales: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_sales"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy`.`stg_sales`
  OPTIONS()
  as 

-- Clean and normalize the sales table
select
  date_date,
  cast(customer_id as int64) as customer_id,
  cast(order_id as int64) as order_id,
  cast(products_id as int64) as product_id,
  cast(net_sales as float64) as net_sales,
  cast(qty as int64) as qty
from `sage-tribute-474816-g2`.`Astrafy`.`sales_recrutement`
where date_date is not null;


[0m18:42:41.204826 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:42:42.527838 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:2aaea694-a25c-4563-b1ce-1954c254a0cf&page=queryresults
[0m18:42:42.886982 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53751a15-8a4f-4da1-8ebc-00616681cf14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A05F034EB0>]}
[0m18:42:42.886982 [info ] [Thread-1  ]: 2 of 2 OK created sql view model Astrafy.stg_sales ............................. [[32mCREATE VIEW (0 processed)[0m in 1.72s]
[0m18:42:42.902584 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_sales
[0m18:42:42.902584 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:42:42.902584 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:42:42.902584 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2' was properly closed.
[0m18:42:42.902584 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy' was properly closed.
[0m18:42:42.902584 [debug] [MainThread]: Connection 'model.Astrafy.stg_sales' was properly closed.
[0m18:42:42.920243 [info ] [MainThread]: 
[0m18:42:42.922238 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 7.80 seconds (7.80s).
[0m18:42:42.926229 [debug] [MainThread]: Command end result
[0m18:42:42.987060 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m18:42:43.003587 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m18:42:43.029624 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m18:42:43.031620 [info ] [MainThread]: 
[0m18:42:43.033614 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:42:43.036704 [info ] [MainThread]: 
[0m18:42:43.039149 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m18:42:43.043139 [debug] [MainThread]: Command `dbt run` succeeded at 18:42:43.042142 after 16.56 seconds
[0m18:42:43.044136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A05DCAB970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A073075910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A07361B3A0>]}
[0m18:42:43.045134 [debug] [MainThread]: Flushing usage events
[0m18:42:43.545842 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:51:15.482411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DBBC8B970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DBDF35400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DBDF35190>]}


============================== 18:51:15.482411 | 49fffb89-5252-47ae-bc46-6a9f3776ddd3 ==============================
[0m18:51:15.482411 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m18:51:15.482411 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'empty': 'False', 'use_experimental_parser': 'False', 'quiet': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m18:51:22.157969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '49fffb89-5252-47ae-bc46-6a9f3776ddd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DD0E46CA0>]}
[0m18:51:22.268646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '49fffb89-5252-47ae-bc46-6a9f3776ddd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DBDECB790>]}
[0m18:51:22.271414 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m18:51:23.462795 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m18:51:23.671516 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m18:51:23.687138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '49fffb89-5252-47ae-bc46-6a9f3776ddd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DBD6794C0>]}
[0m18:51:25.988365 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.Astrafy.marts
[0m18:51:26.013682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '49fffb89-5252-47ae-bc46-6a9f3776ddd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DD1A4D130>]}
[0m18:51:26.310895 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m18:51:26.326517 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m18:51:26.389037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '49fffb89-5252-47ae-bc46-6a9f3776ddd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DCAE25580>]}
[0m18:51:26.389037 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 508 macros
[0m18:51:26.389037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49fffb89-5252-47ae-bc46-6a9f3776ddd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DBA063C10>]}
[0m18:51:26.389037 [info ] [MainThread]: 
[0m18:51:26.389037 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:51:26.389037 [info ] [MainThread]: 
[0m18:51:26.401425 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:51:26.410014 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m18:51:26.410014 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:51:27.124342 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:27.699758 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2, now create_sage-tribute-474816-g2_Astrafy_staging)
[0m18:51:27.699758 [debug] [ThreadPool]: Creating schema "database: "sage-tribute-474816-g2"
schema: "Astrafy_staging"
"
[0m18:51:27.746619 [debug] [ThreadPool]: On create_sage-tribute-474816-g2_Astrafy_staging: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "connection_name": "create_sage-tribute-474816-g2_Astrafy_staging"} */
create schema if not exists `sage-tribute-474816-g2`.`Astrafy_staging`
  
[0m18:51:27.746619 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:28.798813 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:c4c88f05-4b05-4b6c-9ed3-a1ae7dc878ec&page=queryresults
[0m18:51:31.938061 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy_staging'
[0m18:51:31.938061 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:51:32.783529 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_staging, now list_sage-tribute-474816-g2_Astrafy)
[0m18:51:32.783529 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:33.507993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49fffb89-5252-47ae-bc46-6a9f3776ddd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DBA2E2250>]}
[0m18:51:33.507993 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:51:33.523616 [debug] [Thread-1  ]: Began running node model.Astrafy.my_first_dbt_model
[0m18:51:33.523616 [info ] [Thread-1  ]: 1 of 4 START sql table model Astrafy.my_first_dbt_model ........................ [RUN]
[0m18:51:33.539231 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.my_first_dbt_model'
[0m18:51:33.539231 [debug] [Thread-1  ]: Began compiling node model.Astrafy.my_first_dbt_model
[0m18:51:33.567913 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.my_first_dbt_model"
[0m18:51:33.567913 [debug] [Thread-1  ]: Began executing node model.Astrafy.my_first_dbt_model
[0m18:51:33.605510 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m18:51:34.228832 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.my_first_dbt_model"
[0m18:51:34.260072 [debug] [Thread-1  ]: On model.Astrafy.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.my_first_dbt_model"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
      
    
    

    
    OPTIONS(
      description="""A starter dbt model"""
    )
    as (
      /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
    );
  
[0m18:51:34.902035 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:5c1630db-d930-41d0-8da5-c60ec36f8a48&page=queryresults
[0m18:51:37.523491 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49fffb89-5252-47ae-bc46-6a9f3776ddd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DBDCBD8B0>]}
[0m18:51:37.523491 [info ] [Thread-1  ]: 1 of 4 OK created sql table model Astrafy.my_first_dbt_model ................... [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 3.98s]
[0m18:51:37.523491 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_first_dbt_model
[0m18:51:37.523491 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_orders
[0m18:51:37.523491 [info ] [Thread-1  ]: 2 of 4 START sql view model Astrafy_staging.stg_orders ......................... [RUN]
[0m18:51:37.523491 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.my_first_dbt_model, now model.Astrafy.stg_orders)
[0m18:51:37.538503 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_orders
[0m18:51:37.542112 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_orders"
[0m18:51:37.555069 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_orders
[0m18:51:37.605390 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_orders"
[0m18:51:37.609379 [debug] [Thread-1  ]: On model.Astrafy.stg_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_orders"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
  OPTIONS(
      description="""Cleaned and normalized orders table."""
    )
  as 

-- Clean and normalize the orders table
select
  date_date,
  cast(customers_id as int64) as customer_id,
  cast(orders_id as int64) as order_id,
  cast(net_sales as float64) as net_sales
from `sage-tribute-474816-g2`.`Astrafy`.`orders_recrutement`
where date_date is not null;


[0m18:51:37.611375 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:51:38.704160 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:8d4224f5-c1fb-4ea0-b848-65fa9e0abb24&page=queryresults
[0m18:51:42.107729 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49fffb89-5252-47ae-bc46-6a9f3776ddd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DD1837F70>]}
[0m18:51:42.107729 [info ] [Thread-1  ]: 2 of 4 OK created sql view model Astrafy_staging.stg_orders .................... [[32mCREATE VIEW (0 processed)[0m in 4.57s]
[0m18:51:42.107729 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_orders
[0m18:51:42.107729 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_sales
[0m18:51:42.128556 [info ] [Thread-1  ]: 3 of 4 START sql view model Astrafy_staging.stg_sales .......................... [RUN]
[0m18:51:42.132981 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_orders, now model.Astrafy.stg_sales)
[0m18:51:42.143663 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_sales
[0m18:51:42.160189 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_sales"
[0m18:51:42.160189 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_sales
[0m18:51:42.175730 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_sales"
[0m18:51:42.181202 [debug] [Thread-1  ]: On model.Astrafy.stg_sales: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_sales"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  OPTIONS(
      description="""Cleaned and normalized sales table with product-level details."""
    )
  as 

-- Clean and normalize the sales table
select
  date_date,
  cast(customer_id as int64) as customer_id,
  cast(order_id as int64) as order_id,
  cast(products_id as int64) as product_id,
  cast(net_sales as float64) as net_sales,
  cast(qty as int64) as qty
from `sage-tribute-474816-g2`.`Astrafy`.`sales_recrutement`
where date_date is not null;


[0m18:51:42.182204 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:51:43.098572 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:cc8ea975-5538-4de9-8d08-83b3e8bb0d67&page=queryresults
[0m18:51:45.796333 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49fffb89-5252-47ae-bc46-6a9f3776ddd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DD2D9BFA0>]}
[0m18:51:45.812000 [info ] [Thread-1  ]: 3 of 4 OK created sql view model Astrafy_staging.stg_sales ..................... [[32mCREATE VIEW (0 processed)[0m in 3.66s]
[0m18:51:45.812000 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_sales
[0m18:51:45.812000 [debug] [Thread-1  ]: Began running node model.Astrafy.my_second_dbt_model
[0m18:51:45.812000 [info ] [Thread-1  ]: 4 of 4 START sql view model Astrafy.my_second_dbt_model ........................ [RUN]
[0m18:51:45.833235 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_sales, now model.Astrafy.my_second_dbt_model)
[0m18:51:45.837323 [debug] [Thread-1  ]: Began compiling node model.Astrafy.my_second_dbt_model
[0m18:51:45.848229 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.my_second_dbt_model"
[0m18:51:45.848229 [debug] [Thread-1  ]: Began executing node model.Astrafy.my_second_dbt_model
[0m18:51:45.863466 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.my_second_dbt_model"
[0m18:51:45.863466 [debug] [Thread-1  ]: On model.Astrafy.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.my_second_dbt_model"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy`.`my_second_dbt_model`
  OPTIONS(
      description="""A starter dbt model"""
    )
  as -- Use the `ref` function to select from other models

select *
from `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
where id = 1;


[0m18:51:45.878408 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m18:51:46.723128 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:1f716d62-2123-4453-815e-97093d1b6868&page=queryresults
[0m18:51:47.822098 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49fffb89-5252-47ae-bc46-6a9f3776ddd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DD2D9D790>]}
[0m18:51:47.822098 [info ] [Thread-1  ]: 4 of 4 OK created sql view model Astrafy.my_second_dbt_model ................... [[32mCREATE VIEW (0 processed)[0m in 1.99s]
[0m18:51:47.837762 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_second_dbt_model
[0m18:51:47.837762 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:51:47.859918 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:51:47.863533 [debug] [MainThread]: Connection 'create_sage-tribute-474816-g2_Astrafy_staging' was properly closed.
[0m18:51:47.865403 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy' was properly closed.
[0m18:51:47.865403 [debug] [MainThread]: Connection 'model.Astrafy.my_second_dbt_model' was properly closed.
[0m18:51:47.865403 [info ] [MainThread]: 
[0m18:51:47.865403 [info ] [MainThread]: Finished running 1 table model, 3 view models in 0 hours 0 minutes and 21.47 seconds (21.47s).
[0m18:51:47.881539 [debug] [MainThread]: Command end result
[0m18:51:47.931511 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m18:51:47.951392 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m18:51:47.964419 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m18:51:47.965419 [info ] [MainThread]: 
[0m18:51:47.967067 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:51:47.967717 [info ] [MainThread]: 
[0m18:51:47.969106 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m18:51:47.972540 [debug] [MainThread]: Command `dbt run` succeeded at 18:51:47.972540 after 32.65 seconds
[0m18:51:47.974535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DBBC8B970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DBB6943A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020DBCFFFB50>]}
[0m18:51:47.974535 [debug] [MainThread]: Flushing usage events
[0m18:51:48.526495 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:06:26.917750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190E673B940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190E89E53A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190E89E5130>]}


============================== 19:06:26.917750 | 23d7c870-05bf-44dc-8a8c-cbfb0f9c2570 ==============================
[0m19:06:26.917750 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:06:26.933373 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'empty': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:06:31.179903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190E4B13910>]}
[0m19:06:31.274229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190F13EF910>]}
[0m19:06:31.274229 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m19:06:32.453831 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:06:32.662126 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m19:06:32.662126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190E8114A90>]}
[0m19:06:35.649587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FC50C130>]}
[0m19:06:35.993256 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:06:35.993256 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:06:36.040121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FC268610>]}
[0m19:06:36.055747 [info ] [MainThread]: Found 7 models, 4 data tests, 2 sources, 508 macros
[0m19:06:36.055747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FC51B8E0>]}
[0m19:06:36.055747 [info ] [MainThread]: 
[0m19:06:36.063261 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:06:36.065920 [info ] [MainThread]: 
[0m19:06:36.068955 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:06:36.083976 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m19:06:36.083976 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:06:36.703924 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:06:37.185089 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:06:37.674302 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2, now create_sage-tribute-474816-g2_Astrafy_marts)
[0m19:06:37.674302 [debug] [ThreadPool]: Creating schema "database: "sage-tribute-474816-g2"
schema: "Astrafy_marts"
"
[0m19:06:37.689928 [debug] [ThreadPool]: On create_sage-tribute-474816-g2_Astrafy_marts: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "connection_name": "create_sage-tribute-474816-g2_Astrafy_marts"} */
create schema if not exists `sage-tribute-474816-g2`.`Astrafy_marts`
  
[0m19:06:37.689928 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:06:38.583788 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:dda84483-98ec-4603-a46a-ec69ea696302&page=queryresults
[0m19:06:40.293738 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy_staging'
[0m19:06:40.293738 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:06:40.874078 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_staging, now list_sage-tribute-474816-g2_Astrafy_marts)
[0m19:06:40.874078 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:06:41.661112 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_marts, now list_sage-tribute-474816-g2_Astrafy)
[0m19:06:41.676633 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:06:42.256921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190E55E33A0>]}
[0m19:06:42.272539 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:06:42.288165 [debug] [Thread-1  ]: Began running node model.Astrafy.my_first_dbt_model
[0m19:06:42.288165 [info ] [Thread-1  ]: 1 of 7 START sql table model Astrafy.my_first_dbt_model ........................ [RUN]
[0m19:06:42.288165 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.my_first_dbt_model'
[0m19:06:42.288165 [debug] [Thread-1  ]: Began compiling node model.Astrafy.my_first_dbt_model
[0m19:06:42.319217 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.my_first_dbt_model"
[0m19:06:42.323267 [debug] [Thread-1  ]: Began executing node model.Astrafy.my_first_dbt_model
[0m19:06:42.340266 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m19:06:43.025517 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.my_first_dbt_model"
[0m19:06:43.025517 [debug] [Thread-1  ]: On model.Astrafy.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.my_first_dbt_model"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
      
    
    

    
    OPTIONS(
      description="""A starter dbt model"""
    )
    as (
      /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
    );
  
[0m19:06:43.726534 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:6673f473-e24b-48c2-8e80-383ef625ce0c&page=queryresults
[0m19:06:46.479245 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FC1DF5E0>]}
[0m19:06:46.479245 [info ] [Thread-1  ]: 1 of 7 OK created sql table model Astrafy.my_first_dbt_model ................... [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 4.18s]
[0m19:06:46.479245 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_first_dbt_model
[0m19:06:46.479245 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_orders
[0m19:06:46.479245 [info ] [Thread-1  ]: 2 of 7 START sql view model Astrafy_staging.stg_orders ......................... [RUN]
[0m19:06:46.494860 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.my_first_dbt_model, now model.Astrafy.stg_orders)
[0m19:06:46.497487 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_orders
[0m19:06:46.498864 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_orders"
[0m19:06:46.512397 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_orders
[0m19:06:46.545206 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_orders"
[0m19:06:46.545206 [debug] [Thread-1  ]: On model.Astrafy.stg_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_orders"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
  OPTIONS(
      description="""Cleaned and normalized orders table."""
    )
  as 

-- Clean and normalize the orders table
select
  date_date,
  cast(customers_id as int64) as customer_id,
  cast(orders_id as int64) as order_id,
  cast(net_sales as float64) as net_sales
from `sage-tribute-474816-g2`.`Astrafy`.`orders_recrutement`
where date_date is not null;


[0m19:06:46.545206 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:06:47.405328 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:0740e5ae-567c-4a40-b6c3-a472d61255f6&page=queryresults
[0m19:06:48.142588 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FC1D2FA0>]}
[0m19:06:48.142588 [info ] [Thread-1  ]: 2 of 7 OK created sql view model Astrafy_staging.stg_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.66s]
[0m19:06:48.158210 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_orders
[0m19:06:48.158210 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_sales
[0m19:06:48.158210 [info ] [Thread-1  ]: 3 of 7 START sql view model Astrafy_staging.stg_sales .......................... [RUN]
[0m19:06:48.173175 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_orders, now model.Astrafy.stg_sales)
[0m19:06:48.177314 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_sales
[0m19:06:48.196069 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_sales"
[0m19:06:48.196069 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_sales
[0m19:06:48.212841 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_sales"
[0m19:06:48.212841 [debug] [Thread-1  ]: On model.Astrafy.stg_sales: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_sales"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  OPTIONS(
      description="""Cleaned and normalized sales table with product-level details."""
    )
  as 

-- Clean and normalize the sales table
select
  date_date,
  cast(customer_id as int64) as customer_id,
  cast(order_id as int64) as order_id,
  cast(products_id as int64) as product_id,
  cast(net_sales as float64) as net_sales,
  cast(qty as int64) as qty
from `sage-tribute-474816-g2`.`Astrafy`.`sales_recrutement`
where date_date is not null;


[0m19:06:48.212841 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:06:49.711729 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:d516e186-e858-4620-8ee7-67a6b8b9408d&page=queryresults
[0m19:06:50.432865 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FC1D20D0>]}
[0m19:06:50.432865 [info ] [Thread-1  ]: 3 of 7 OK created sql view model Astrafy_staging.stg_sales ..................... [[32mCREATE VIEW (0 processed)[0m in 2.27s]
[0m19:06:50.448488 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_sales
[0m19:06:50.448488 [debug] [Thread-1  ]: Began running node model.Astrafy.my_second_dbt_model
[0m19:06:50.448488 [info ] [Thread-1  ]: 4 of 7 START sql view model Astrafy.my_second_dbt_model ........................ [RUN]
[0m19:06:50.466040 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_sales, now model.Astrafy.my_second_dbt_model)
[0m19:06:50.466256 [debug] [Thread-1  ]: Began compiling node model.Astrafy.my_second_dbt_model
[0m19:06:50.466256 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.my_second_dbt_model"
[0m19:06:50.483798 [debug] [Thread-1  ]: Began executing node model.Astrafy.my_second_dbt_model
[0m19:06:50.483798 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.my_second_dbt_model"
[0m19:06:50.500562 [debug] [Thread-1  ]: On model.Astrafy.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.my_second_dbt_model"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy`.`my_second_dbt_model`
  OPTIONS(
      description="""A starter dbt model"""
    )
  as -- Use the `ref` function to select from other models

select *
from `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
where id = 1;


[0m19:06:50.500562 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:06:51.374611 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:81b9f099-28a4-40c5-be0e-803c8915dd89&page=queryresults
[0m19:06:52.515625 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FBF51AC0>]}
[0m19:06:52.515625 [info ] [Thread-1  ]: 4 of 7 OK created sql view model Astrafy.my_second_dbt_model ................... [[32mCREATE VIEW (0 processed)[0m in 2.05s]
[0m19:06:52.531249 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_second_dbt_model
[0m19:06:52.531249 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_1_total_orders
[0m19:06:52.531249 [info ] [Thread-1  ]: 5 of 7 START sql table model Astrafy_marts.ex_1_total_orders ................... [RUN]
[0m19:06:52.547491 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.my_second_dbt_model, now model.Astrafy.ex_1_total_orders)
[0m19:06:52.550296 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_1_total_orders
[0m19:06:52.550708 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_1_total_orders"
[0m19:06:52.550708 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_1_total_orders
[0m19:06:52.566922 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_1_total_orders"
[0m19:06:52.566922 [debug] [Thread-1  ]: On model.Astrafy.ex_1_total_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_1_total_orders"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_1_total_orders`
      
    
    

    
    OPTIONS(
      description="""Total number of unique orders placed in 2023."""
    )
    as (
      

-- Total number of unique orders placed in 2023
select
  count(distinct order_id) as total_orders_2023
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
    );
  
[0m19:06:52.566922 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:06:54.736103 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:8e0e8fe2-aa32-4439-81f7-4fbaea4a1d2a&page=queryresults
[0m19:06:59.280742 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FD84FFD0>]}
[0m19:06:59.282736 [info ] [Thread-1  ]: 5 of 7 OK created sql table model Astrafy_marts.ex_1_total_orders .............. [[32mCREATE TABLE (1.0 rows, 57.2 KiB processed)[0m in 6.75s]
[0m19:06:59.287902 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_1_total_orders
[0m19:06:59.289732 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_2_orders_per_month
[0m19:06:59.292737 [info ] [Thread-1  ]: 6 of 7 START sql table model Astrafy_marts.ex_2_orders_per_month ............... [RUN]
[0m19:06:59.296714 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_1_total_orders, now model.Astrafy.ex_2_orders_per_month)
[0m19:06:59.298709 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_2_orders_per_month
[0m19:06:59.310679 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_2_orders_per_month"
[0m19:06:59.315663 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_2_orders_per_month
[0m19:06:59.326636 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_2_orders_per_month"
[0m19:06:59.331621 [debug] [Thread-1  ]: On model.Astrafy.ex_2_orders_per_month: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_2_orders_per_month"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_2_orders_per_month`
      
    
    

    
    OPTIONS(
      description="""Monthly order volume for 2023."""
    )
    as (
      

-- Monthly order count for 2023
select
  extract(year from date_date) as year,
  extract(month from date_date) as month,
  count(distinct order_id) as orders_per_month
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
group by 1, 2
order by year, month
    );
  
[0m19:06:59.332620 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:07:00.834445 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:70df361c-f254-4b32-8fc0-62200362b48e&page=queryresults
[0m19:07:04.685664 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FC3A9370>]}
[0m19:07:04.685664 [info ] [Thread-1  ]: 6 of 7 OK created sql table model Astrafy_marts.ex_2_orders_per_month .......... [[32mCREATE TABLE (12.0 rows, 57.2 KiB processed)[0m in 5.39s]
[0m19:07:04.698689 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_2_orders_per_month
[0m19:07:04.700683 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_3_avg_products_per_order
[0m19:07:04.707627 [info ] [Thread-1  ]: 7 of 7 START sql table model Astrafy_marts.ex_3_avg_products_per_order ......... [RUN]
[0m19:07:04.715230 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_2_orders_per_month, now model.Astrafy.ex_3_avg_products_per_order)
[0m19:07:04.717224 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_3_avg_products_per_order
[0m19:07:04.728222 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_3_avg_products_per_order"
[0m19:07:04.736929 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_3_avg_products_per_order
[0m19:07:04.744876 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_3_avg_products_per_order"
[0m19:07:04.751942 [debug] [Thread-1  ]: On model.Astrafy.ex_3_avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_3_avg_products_per_order"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_3_avg_products_per_order`
      
    
    

    
    OPTIONS(
      description="""Average number of distinct products per order for each month in 2023."""
    )
    as (
      

-- Calculate average number of products per order for each month in 2023
with products_per_order as (
  select
    order_id,
    count(distinct product_id) as product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  where extract(year from date_date) = 2023
  group by order_id
),
orders_monthly as (
  select
    extract(month from s.date_date) as month,
    p.product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales` s
  join products_per_order p using (order_id)
  where extract(year from s.date_date) = 2023
)
select
  month,
  avg(product_count) as avg_products_per_order
from orders_monthly
group by month
order by month
    );
  
[0m19:07:04.753941 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:07:07.666886 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:ec2f5acd-b57e-4ba9-b296-ba9ec9e4077c&page=queryresults
[0m19:07:12.485519 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23d7c870-05bf-44dc-8a8c-cbfb0f9c2570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FC1DF5E0>]}
[0m19:07:12.501009 [info ] [Thread-1  ]: 7 of 7 OK created sql table model Astrafy_marts.ex_3_avg_products_per_order .... [[32mCREATE TABLE (12.0 rows, 664.7 KiB processed)[0m in 7.77s]
[0m19:07:12.501009 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_3_avg_products_per_order
[0m19:07:12.518389 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:07:12.522821 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:07:12.522821 [debug] [MainThread]: Connection 'create_sage-tribute-474816-g2_Astrafy_marts' was properly closed.
[0m19:07:12.522821 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy' was properly closed.
[0m19:07:12.522821 [debug] [MainThread]: Connection 'model.Astrafy.ex_3_avg_products_per_order' was properly closed.
[0m19:07:12.522821 [info ] [MainThread]: 
[0m19:07:12.522821 [info ] [MainThread]: Finished running 4 table models, 3 view models in 0 hours 0 minutes and 36.45 seconds (36.45s).
[0m19:07:12.537247 [debug] [MainThread]: Command end result
[0m19:07:12.604233 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:07:12.604233 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:07:12.620882 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m19:07:12.620882 [info ] [MainThread]: 
[0m19:07:12.620882 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:07:12.620882 [info ] [MainThread]: 
[0m19:07:12.620882 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=7
[0m19:07:12.620882 [debug] [MainThread]: Command `dbt run` succeeded at 19:07:12.620882 after 45.84 seconds
[0m19:07:12.620882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190E673B940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FC32F430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000190FC32F730>]}
[0m19:07:12.620882 [debug] [MainThread]: Flushing usage events
[0m19:07:13.306554 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:19:30.334023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002007947B9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002007B7253D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002007B725160>]}


============================== 19:19:30.334023 | fc571b72-0771-41dc-b82c-23814c80afb6 ==============================
[0m19:19:30.334023 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:19:30.334023 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'invocation_command': 'dbt run', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'empty': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:19:36.814317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020077853850>]}
[0m19:19:36.923700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002007B54BC10>]}
[0m19:19:36.923700 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m19:19:38.085189 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:19:38.470766 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 3 files added, 1 files changed.
[0m19:19:38.470766 [debug] [MainThread]: Partial parsing: added file: Astrafy://models\marts\ex_6_orders_2023_with_segmentation.sql
[0m19:19:38.470766 [debug] [MainThread]: Partial parsing: added file: Astrafy://models\marts\ex_4_orders_with_qty.sql
[0m19:19:38.470766 [debug] [MainThread]: Partial parsing: added file: Astrafy://models\marts\ex_5_order_segmentation.sql
[0m19:19:38.470766 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\schema.yml
[0m19:19:39.073670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002000F16C130>]}
[0m19:19:39.254499 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:19:39.262313 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:19:39.311790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002000F180BE0>]}
[0m19:19:39.311790 [info ] [MainThread]: Found 10 models, 4 data tests, 2 sources, 508 macros
[0m19:19:39.311790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002000F1B1070>]}
[0m19:19:39.311790 [info ] [MainThread]: 
[0m19:19:39.327446 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:19:39.327446 [info ] [MainThread]: 
[0m19:19:39.331815 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:19:39.331815 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m19:19:39.331815 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:19:40.035606 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:40.716980 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:41.414737 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy'
[0m19:19:41.414737 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:19:42.073140 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy, now list_sage-tribute-474816-g2_Astrafy_staging)
[0m19:19:42.088632 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:42.685107 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_staging, now list_sage-tribute-474816-g2_Astrafy_marts)
[0m19:19:42.685107 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:19:43.312401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002000EE972B0>]}
[0m19:19:43.312401 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:19:43.312401 [debug] [Thread-1  ]: Began running node model.Astrafy.my_first_dbt_model
[0m19:19:43.312401 [info ] [Thread-1  ]: 1 of 10 START sql table model Astrafy.my_first_dbt_model ....................... [RUN]
[0m19:19:43.312401 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.my_first_dbt_model'
[0m19:19:43.312401 [debug] [Thread-1  ]: Began compiling node model.Astrafy.my_first_dbt_model
[0m19:19:43.355670 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.my_first_dbt_model"
[0m19:19:43.357340 [debug] [Thread-1  ]: Began executing node model.Astrafy.my_first_dbt_model
[0m19:19:43.386320 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m19:19:44.070375 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.my_first_dbt_model"
[0m19:19:44.070375 [debug] [Thread-1  ]: On model.Astrafy.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.my_first_dbt_model"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
      
    
    

    
    OPTIONS(
      description="""A starter dbt model"""
    )
    as (
      /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
    );
  
[0m19:19:44.678310 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:d415f8fb-b5ae-41cd-b3f7-6ea120dd7b02&page=queryresults
[0m19:19:47.503371 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002007B6DF1F0>]}
[0m19:19:47.503371 [info ] [Thread-1  ]: 1 of 10 OK created sql table model Astrafy.my_first_dbt_model .................. [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 4.18s]
[0m19:19:47.503371 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_first_dbt_model
[0m19:19:47.503371 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_orders
[0m19:19:47.503371 [info ] [Thread-1  ]: 2 of 10 START sql view model Astrafy_staging.stg_orders ........................ [RUN]
[0m19:19:47.503371 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.my_first_dbt_model, now model.Astrafy.stg_orders)
[0m19:19:47.519215 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_orders
[0m19:19:47.525172 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_orders"
[0m19:19:47.525172 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_orders
[0m19:19:47.557128 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_orders"
[0m19:19:47.573833 [debug] [Thread-1  ]: On model.Astrafy.stg_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_orders"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
  OPTIONS(
      description="""Cleaned and normalized orders table."""
    )
  as 

-- Clean and normalize the orders table
select
  date_date,
  cast(customers_id as int64) as customer_id,
  cast(orders_id as int64) as order_id,
  cast(net_sales as float64) as net_sales
from `sage-tribute-474816-g2`.`Astrafy`.`orders_recrutement`
where date_date is not null;


[0m19:19:47.573833 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:19:48.475971 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:bc8152d2-2d95-4baf-b361-ea91cbbec1bf&page=queryresults
[0m19:19:49.324179 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020079377CA0>]}
[0m19:19:49.339800 [info ] [Thread-1  ]: 2 of 10 OK created sql view model Astrafy_staging.stg_orders ................... [[32mCREATE VIEW (0 processed)[0m in 1.82s]
[0m19:19:49.339800 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_orders
[0m19:19:49.339800 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_sales
[0m19:19:49.355422 [info ] [Thread-1  ]: 3 of 10 START sql view model Astrafy_staging.stg_sales ......................... [RUN]
[0m19:19:49.355422 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_orders, now model.Astrafy.stg_sales)
[0m19:19:49.355422 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_sales
[0m19:19:49.525209 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_sales"
[0m19:19:49.525209 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_sales
[0m19:19:49.540831 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_sales"
[0m19:19:49.540831 [debug] [Thread-1  ]: On model.Astrafy.stg_sales: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_sales"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  OPTIONS(
      description="""Cleaned and normalized sales table with product-level details."""
    )
  as 

-- Clean and normalize the sales table
select
  date_date,
  cast(customer_id as int64) as customer_id,
  cast(order_id as int64) as order_id,
  cast(products_id as int64) as product_id,
  cast(net_sales as float64) as net_sales,
  cast(qty as int64) as qty
from `sage-tribute-474816-g2`.`Astrafy`.`sales_recrutement`
where date_date is not null;


[0m19:19:49.540831 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:19:50.378178 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:4a56fa90-5613-4722-9a13-1bb7c41e8c77&page=queryresults
[0m19:19:51.116154 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002000F081F70>]}
[0m19:19:51.131776 [info ] [Thread-1  ]: 3 of 10 OK created sql view model Astrafy_staging.stg_sales .................... [[32mCREATE VIEW (0 processed)[0m in 1.76s]
[0m19:19:51.131776 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_sales
[0m19:19:51.131776 [debug] [Thread-1  ]: Began running node model.Astrafy.my_second_dbt_model
[0m19:19:51.131776 [info ] [Thread-1  ]: 4 of 10 START sql view model Astrafy.my_second_dbt_model ....................... [RUN]
[0m19:19:51.144739 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_sales, now model.Astrafy.my_second_dbt_model)
[0m19:19:51.148916 [debug] [Thread-1  ]: Began compiling node model.Astrafy.my_second_dbt_model
[0m19:19:51.162256 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.my_second_dbt_model"
[0m19:19:51.165212 [debug] [Thread-1  ]: Began executing node model.Astrafy.my_second_dbt_model
[0m19:19:51.165212 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.my_second_dbt_model"
[0m19:19:51.180501 [debug] [Thread-1  ]: On model.Astrafy.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.my_second_dbt_model"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy`.`my_second_dbt_model`
  OPTIONS(
      description="""A starter dbt model"""
    )
  as -- Use the `ref` function to select from other models

select *
from `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
where id = 1;


[0m19:19:51.180501 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:19:52.030044 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:ac89b3be-be59-428f-8232-cc0eda0cf343&page=queryresults
[0m19:19:53.187517 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002001027FA90>]}
[0m19:19:53.203136 [info ] [Thread-1  ]: 4 of 10 OK created sql view model Astrafy.my_second_dbt_model .................. [[32mCREATE VIEW (0 processed)[0m in 2.06s]
[0m19:19:53.203136 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_second_dbt_model
[0m19:19:53.203136 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_1_total_orders
[0m19:19:53.203136 [info ] [Thread-1  ]: 5 of 10 START sql table model Astrafy_marts.ex_1_total_orders .................. [RUN]
[0m19:19:53.219159 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.my_second_dbt_model, now model.Astrafy.ex_1_total_orders)
[0m19:19:53.221757 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_1_total_orders
[0m19:19:53.229794 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_1_total_orders"
[0m19:19:53.229794 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_1_total_orders
[0m19:19:53.254375 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:19:53.866220 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_1_total_orders"
[0m19:19:53.870209 [debug] [Thread-1  ]: On model.Astrafy.ex_1_total_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_1_total_orders"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_1_total_orders`
      
    
    

    
    OPTIONS(
      description="""Total number of unique orders placed in 2023."""
    )
    as (
      

-- Total number of unique orders placed in 2023
select
  count(distinct order_id) as total_orders_2023
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
    );
  
[0m19:19:54.608211 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:a773fccc-f770-4586-a7ef-83ea582ee8cc&page=queryresults
[0m19:20:43.381561 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020010621580>]}
[0m19:20:43.386584 [info ] [Thread-1  ]: 5 of 10 OK created sql table model Astrafy_marts.ex_1_total_orders ............. [[32mCREATE TABLE (1.0 rows, 57.2 KiB processed)[0m in 50.18s]
[0m19:20:43.393945 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_1_total_orders
[0m19:20:43.398733 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_2_orders_per_month
[0m19:20:43.404724 [info ] [Thread-1  ]: 6 of 10 START sql table model Astrafy_marts.ex_2_orders_per_month .............. [RUN]
[0m19:20:43.410700 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_1_total_orders, now model.Astrafy.ex_2_orders_per_month)
[0m19:20:43.416312 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_2_orders_per_month
[0m19:20:43.433730 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_2_orders_per_month"
[0m19:20:43.439894 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_2_orders_per_month
[0m19:20:43.442926 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:20:44.047580 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_2_orders_per_month"
[0m19:20:44.063614 [debug] [Thread-1  ]: On model.Astrafy.ex_2_orders_per_month: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_2_orders_per_month"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_2_orders_per_month`
      
    
    

    
    OPTIONS(
      description="""Monthly order volume for 2023."""
    )
    as (
      

-- Monthly order count for 2023
select
  extract(year from date_date) as year,
  extract(month from date_date) as month,
  count(distinct order_id) as orders_per_month
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
group by 1, 2
order by year, month
    );
  
[0m19:20:44.820423 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:dc7c59f3-508b-4750-9a9c-ee859f44047e&page=queryresults
[0m19:20:47.194790 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002000E72BAF0>]}
[0m19:20:47.199659 [info ] [Thread-1  ]: 6 of 10 OK created sql table model Astrafy_marts.ex_2_orders_per_month ......... [[32mCREATE TABLE (12.0 rows, 57.2 KiB processed)[0m in 3.78s]
[0m19:20:47.207017 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_2_orders_per_month
[0m19:20:47.209013 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_5_order_segmentation
[0m19:20:47.211006 [info ] [Thread-1  ]: 7 of 10 START sql table model Astrafy_marts.ex_5_order_segmentation ............ [RUN]
[0m19:20:47.232899 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_2_orders_per_month, now model.Astrafy.ex_5_order_segmentation)
[0m19:20:47.235893 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_5_order_segmentation
[0m19:20:47.256450 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_5_order_segmentation"
[0m19:20:47.276486 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_5_order_segmentation
[0m19:20:47.292595 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_5_order_segmentation"
[0m19:20:47.304735 [debug] [Thread-1  ]: On model.Astrafy.ex_5_order_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_5_order_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation`
      
    
    

    
    OPTIONS(
      description="""Segmentation of 2023 orders based on past 12-month purchase behavior."""
    )
    as (
      

-- Determine order segmentation (New, Returning, VIP)
with orders_with_lag as (
    select
        customer_id,
        order_id,
        date_date,
        count(order_id) over (
            partition by customer_id
            order by date_date
            range between interval 12 month preceding and current row
        ) as orders_last_12m
    from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
    where extract(year from date_date) = 2023
)
select
    customer_id,
    order_id,
    date_date,
    case
        when orders_last_12m = 1 then 'New'
        when orders_last_12m between 2 and 4 then 'Returning'
        when orders_last_12m >= 5 then 'VIP'
    end as order_segment
from orders_with_lag
    );
  
[0m19:20:47.307728 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:20:48.501123 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:6bf21a55-26c5-4581-85c6-cb11fff6ed53&page=queryresults
[0m19:20:48.700832 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:6bf21a55-26c5-4581-85c6-cb11fff6ed53&page=queryresults
[0m19:20:48.786572 [debug] [Thread-1  ]: Database Error in model ex_5_order_segmentation (models\marts\ex_5_order_segmentation.sql)
  ORDER BY key must be numeric in a RANGE-based window with OFFSET PRECEDING or OFFSET FOLLOWING boundaries, but has type DATE at [26:13]
  compiled code at target\run\Astrafy\models\marts\ex_5_order_segmentation.sql
[0m19:20:48.786572 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002007B6D6D30>]}
[0m19:20:48.786572 [error] [Thread-1  ]: 7 of 10 ERROR creating sql table model Astrafy_marts.ex_5_order_segmentation ... [[31mERROR[0m in 1.55s]
[0m19:20:48.786572 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_5_order_segmentation
[0m19:20:48.786572 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_3_avg_products_per_order
[0m19:20:48.786572 [debug] [Thread-4  ]: Marking all children of 'model.Astrafy.ex_5_order_segmentation' to be skipped because of status 'error'.  Reason: Database Error in model ex_5_order_segmentation (models\marts\ex_5_order_segmentation.sql)
  ORDER BY key must be numeric in a RANGE-based window with OFFSET PRECEDING or OFFSET FOLLOWING boundaries, but has type DATE at [26:13]
  compiled code at target\run\Astrafy\models\marts\ex_5_order_segmentation.sql.
[0m19:20:48.786572 [info ] [Thread-1  ]: 8 of 10 START sql table model Astrafy_marts.ex_3_avg_products_per_order ........ [RUN]
[0m19:20:48.804158 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_5_order_segmentation, now model.Astrafy.ex_3_avg_products_per_order)
[0m19:20:48.805156 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_3_avg_products_per_order
[0m19:20:48.815132 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_3_avg_products_per_order"
[0m19:20:48.822108 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_3_avg_products_per_order
[0m19:20:48.837547 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:20:49.416139 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_3_avg_products_per_order"
[0m19:20:49.431757 [debug] [Thread-1  ]: On model.Astrafy.ex_3_avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_3_avg_products_per_order"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_3_avg_products_per_order`
      
    
    

    
    OPTIONS(
      description="""Average number of distinct products per order per month in 2023."""
    )
    as (
      

-- Calculate average number of products per order for each month in 2023
with products_per_order as (
  select
    order_id,
    count(distinct product_id) as product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  where extract(year from date_date) = 2023
  group by order_id
),
orders_monthly as (
  select
    extract(month from s.date_date) as month,
    p.product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales` s
  join products_per_order p using (order_id)
  where extract(year from s.date_date) = 2023
)
select
  month,
  avg(product_count) as avg_products_per_order
from orders_monthly
group by month
order by month
    );
  
[0m19:20:50.286741 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:d573d4c0-0a63-4233-bd98-d50fb787cf5e&page=queryresults
[0m19:20:55.009315 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002000EFB7CD0>]}
[0m19:20:55.009315 [info ] [Thread-1  ]: 8 of 10 OK created sql table model Astrafy_marts.ex_3_avg_products_per_order ... [[32mCREATE TABLE (12.0 rows, 664.7 KiB processed)[0m in 6.21s]
[0m19:20:55.009315 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_3_avg_products_per_order
[0m19:20:55.009315 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_4_orders_with_qty
[0m19:20:55.024603 [info ] [Thread-1  ]: 9 of 10 START sql table model Astrafy_marts.ex_4_orders_with_qty ............... [RUN]
[0m19:20:55.029592 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_3_avg_products_per_order, now model.Astrafy.ex_4_orders_with_qty)
[0m19:20:55.031586 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_4_orders_with_qty
[0m19:20:55.047542 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_4_orders_with_qty"
[0m19:20:55.052529 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_4_orders_with_qty
[0m19:20:55.062303 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_4_orders_with_qty"
[0m19:20:55.062303 [debug] [Thread-1  ]: On model.Astrafy.ex_4_orders_with_qty: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_4_orders_with_qty"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_4_orders_with_qty`
      
    
    

    
    OPTIONS(
      description="""Orders for 2022\u20132023 with the total quantity of products in each order."""
    )
    as (
      

-- Table: one line per order, including product quantity
with product_counts as (
    select
        order_id,
        sum(qty) as qty_product
    from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
    where extract(year from date_date) in (2022, 2023)
    group by order_id
)
select
    o.date_date,
    o.customer_id,
    o.order_id,
    o.net_sales,
    p.qty_product
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o
left join product_counts p using (order_id)
where extract(year from o.date_date) in (2022, 2023)
    );
  
[0m19:20:55.062303 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:20:56.179145 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:29fc5c17-ed35-4317-a6b0-7e2b34bba854&page=queryresults
[0m19:20:58.691135 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc571b72-0771-41dc-b82c-23814c80afb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002000EFB7CD0>]}
[0m19:20:58.694127 [info ] [Thread-1  ]: 9 of 10 OK created sql table model Astrafy_marts.ex_4_orders_with_qty .......... [[32mCREATE TABLE (3.7k rows, 779.1 KiB processed)[0m in 3.66s]
[0m19:20:58.705277 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_4_orders_with_qty
[0m19:20:58.707273 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:20:58.710263 [info ] [Thread-1  ]: 10 of 10 SKIP relation Astrafy_marts.ex_6_orders_2023_with_segmentation ........ [[33mSKIP[0m]
[0m19:20:58.719512 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:20:58.725495 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:20:58.738462 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:20:58.740455 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2' was properly closed.
[0m19:20:58.743473 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy_marts' was properly closed.
[0m19:20:58.749409 [debug] [MainThread]: Connection 'model.Astrafy.ex_4_orders_with_qty' was properly closed.
[0m19:20:58.754400 [info ] [MainThread]: 
[0m19:20:58.756401 [info ] [MainThread]: Finished running 7 table models, 3 view models in 0 hours 1 minutes and 19.42 seconds (79.42s).
[0m19:20:58.772405 [debug] [MainThread]: Command end result
[0m19:20:58.906377 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:20:58.920329 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:20:58.945013 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m19:20:58.949359 [info ] [MainThread]: 
[0m19:20:58.952351 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:20:58.953349 [info ] [MainThread]: 
[0m19:20:58.956340 [error] [MainThread]: [31mFailure in model ex_5_order_segmentation (models\marts\ex_5_order_segmentation.sql)[0m
[0m19:20:58.959333 [error] [MainThread]:   Database Error in model ex_5_order_segmentation (models\marts\ex_5_order_segmentation.sql)
  ORDER BY key must be numeric in a RANGE-based window with OFFSET PRECEDING or OFFSET FOLLOWING boundaries, but has type DATE at [26:13]
  compiled code at target\run\Astrafy\models\marts\ex_5_order_segmentation.sql
[0m19:20:58.969305 [info ] [MainThread]: 
[0m19:20:58.972297 [info ] [MainThread]:   compiled code at target\compiled\Astrafy\models\marts\ex_5_order_segmentation.sql
[0m19:20:58.974294 [info ] [MainThread]: 
[0m19:20:58.987259 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=10
[0m19:20:58.990249 [debug] [MainThread]: Command `dbt run` failed at 19:20:58.990249 after 88.81 seconds
[0m19:20:58.991246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002007947B9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002000F180B20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002000ED29730>]}
[0m19:20:58.993247 [debug] [MainThread]: Flushing usage events
[0m19:20:59.758190 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:21:29.566433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2E941B970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2EB6C5400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2EB6C5190>]}


============================== 19:21:29.572420 | 3556522a-0f0d-4cb8-bf03-96677bdf8f2b ==============================
[0m19:21:29.572420 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:21:29.574412 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'empty': 'False', 'warn_error': 'None', 'quiet': 'False', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'invocation_command': 'dbt run', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:21:34.436876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2E79A2EB0>]}
[0m19:21:34.538297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FE5C5C40>]}
[0m19:21:34.539294 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m19:21:35.782083 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:21:36.171267 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:21:36.172265 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:21:36.277616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FEE2CE20>]}
[0m19:21:36.484021 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:21:36.489972 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:21:36.545671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FED77670>]}
[0m19:21:36.546672 [info ] [MainThread]: Found 10 models, 4 data tests, 2 sources, 508 macros
[0m19:21:36.548667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FED4E6A0>]}
[0m19:21:36.552367 [info ] [MainThread]: 
[0m19:21:36.554362 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:21:36.556357 [info ] [MainThread]: 
[0m19:21:36.558357 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:21:36.577302 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m19:21:36.578298 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:21:37.178195 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:21:37.760044 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:21:38.357051 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy_marts'
[0m19:21:38.361046 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:21:39.020141 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_marts, now list_sage-tribute-474816-g2_Astrafy_staging)
[0m19:21:39.030122 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:21:39.716574 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_staging, now list_sage-tribute-474816-g2_Astrafy)
[0m19:21:39.722557 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:21:40.344052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FED737F0>]}
[0m19:21:40.346019 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:21:40.364020 [debug] [Thread-1  ]: Began running node model.Astrafy.my_first_dbt_model
[0m19:21:40.368020 [info ] [Thread-1  ]: 1 of 10 START sql table model Astrafy.my_first_dbt_model ....................... [RUN]
[0m19:21:40.376032 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.my_first_dbt_model'
[0m19:21:40.379993 [debug] [Thread-1  ]: Began compiling node model.Astrafy.my_first_dbt_model
[0m19:21:40.424141 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.my_first_dbt_model"
[0m19:21:40.428161 [debug] [Thread-1  ]: Began executing node model.Astrafy.my_first_dbt_model
[0m19:21:40.455204 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m19:21:41.085172 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.my_first_dbt_model"
[0m19:21:41.091651 [debug] [Thread-1  ]: On model.Astrafy.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.my_first_dbt_model"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
      
    
    

    
    OPTIONS(
      description="""A starter dbt model"""
    )
    as (
      /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
    );
  
[0m19:21:41.495585 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:81a376d4-e557-44a0-8c3a-40a436b65af4&page=queryresults
[0m19:21:44.254522 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FEF82D30>]}
[0m19:21:44.257513 [info ] [Thread-1  ]: 1 of 10 OK created sql table model Astrafy.my_first_dbt_model .................. [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 3.88s]
[0m19:21:44.259538 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_first_dbt_model
[0m19:21:44.261500 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_orders
[0m19:21:44.263528 [info ] [Thread-1  ]: 2 of 10 START sql view model Astrafy_staging.stg_orders ........................ [RUN]
[0m19:21:44.265490 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.my_first_dbt_model, now model.Astrafy.stg_orders)
[0m19:21:44.267517 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_orders
[0m19:21:44.277461 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_orders"
[0m19:21:44.283450 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_orders
[0m19:21:44.328817 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_orders"
[0m19:21:44.334316 [debug] [Thread-1  ]: On model.Astrafy.stg_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_orders"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
  OPTIONS(
      description="""Cleaned and normalized orders table."""
    )
  as 

-- Clean and normalize the orders table
select
  date_date,
  cast(customers_id as int64) as customer_id,
  cast(orders_id as int64) as order_id,
  cast(net_sales as float64) as net_sales
from `sage-tribute-474816-g2`.`Astrafy`.`orders_recrutement`
where date_date is not null;


[0m19:21:44.335315 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:21:45.556634 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:ac7a34cc-736d-4d1d-b775-3c9d23298f8d&page=queryresults
[0m19:21:46.319805 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2EA7A4EB0>]}
[0m19:21:46.322798 [info ] [Thread-1  ]: 2 of 10 OK created sql view model Astrafy_staging.stg_orders ................... [[32mCREATE VIEW (0 processed)[0m in 2.05s]
[0m19:21:46.328789 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_orders
[0m19:21:46.330777 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_sales
[0m19:21:46.332772 [info ] [Thread-1  ]: 3 of 10 START sql view model Astrafy_staging.stg_sales ......................... [RUN]
[0m19:21:46.335763 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_orders, now model.Astrafy.stg_sales)
[0m19:21:46.336767 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_sales
[0m19:21:46.344742 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_sales"
[0m19:21:46.352438 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_sales
[0m19:21:46.366402 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_sales"
[0m19:21:46.370389 [debug] [Thread-1  ]: On model.Astrafy.stg_sales: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_sales"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  OPTIONS(
      description="""Cleaned and normalized sales table with product-level details."""
    )
  as 

-- Clean and normalize the sales table
select
  date_date,
  cast(customer_id as int64) as customer_id,
  cast(order_id as int64) as order_id,
  cast(products_id as int64) as product_id,
  cast(net_sales as float64) as net_sales,
  cast(qty as int64) as qty
from `sage-tribute-474816-g2`.`Astrafy`.`sales_recrutement`
where date_date is not null;


[0m19:21:46.372382 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:21:47.446362 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:2fdd043b-f32b-4dec-9a6c-6b920271573b&page=queryresults
[0m19:21:48.180126 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2EA7A4EB0>]}
[0m19:21:48.182122 [info ] [Thread-1  ]: 3 of 10 OK created sql view model Astrafy_staging.stg_sales .................... [[32mCREATE VIEW (0 processed)[0m in 1.84s]
[0m19:21:48.184821 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_sales
[0m19:21:48.186850 [debug] [Thread-1  ]: Began running node model.Astrafy.my_second_dbt_model
[0m19:21:48.188814 [info ] [Thread-1  ]: 4 of 10 START sql view model Astrafy.my_second_dbt_model ....................... [RUN]
[0m19:21:48.190806 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_sales, now model.Astrafy.my_second_dbt_model)
[0m19:21:48.192802 [debug] [Thread-1  ]: Began compiling node model.Astrafy.my_second_dbt_model
[0m19:21:48.205770 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.my_second_dbt_model"
[0m19:21:48.212748 [debug] [Thread-1  ]: Began executing node model.Astrafy.my_second_dbt_model
[0m19:21:48.224909 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.my_second_dbt_model"
[0m19:21:48.232888 [debug] [Thread-1  ]: On model.Astrafy.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.my_second_dbt_model"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy`.`my_second_dbt_model`
  OPTIONS(
      description="""A starter dbt model"""
    )
  as -- Use the `ref` function to select from other models

select *
from `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
where id = 1;


[0m19:21:48.234883 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:21:49.455788 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:66a77792-df9f-4fcf-a0f4-b1df1e82f2c4&page=queryresults
[0m19:21:50.560676 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FF4698B0>]}
[0m19:21:50.566632 [info ] [Thread-1  ]: 4 of 10 OK created sql view model Astrafy.my_second_dbt_model .................. [[32mCREATE VIEW (0 processed)[0m in 2.37s]
[0m19:21:50.571187 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_second_dbt_model
[0m19:21:50.573189 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_1_total_orders
[0m19:21:50.575212 [info ] [Thread-1  ]: 5 of 10 START sql table model Astrafy_marts.ex_1_total_orders .................. [RUN]
[0m19:21:50.578178 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.my_second_dbt_model, now model.Astrafy.ex_1_total_orders)
[0m19:21:50.584168 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_1_total_orders
[0m19:21:50.593394 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_1_total_orders"
[0m19:21:50.608370 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_1_total_orders
[0m19:21:50.622030 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:21:51.244525 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_1_total_orders"
[0m19:21:51.256452 [debug] [Thread-1  ]: On model.Astrafy.ex_1_total_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_1_total_orders"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_1_total_orders`
      
    
    

    
    OPTIONS(
      description="""Total number of unique orders placed in 2023."""
    )
    as (
      

-- Total number of unique orders placed in 2023
select
  count(distinct order_id) as total_orders_2023
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
    );
  
[0m19:21:52.027795 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:cc4b685c-05d0-4da5-bced-6fd8c6bed51d&page=queryresults
[0m19:21:54.124779 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FF4698B0>]}
[0m19:21:54.128769 [info ] [Thread-1  ]: 5 of 10 OK created sql table model Astrafy_marts.ex_1_total_orders ............. [[32mCREATE TABLE (1.0 rows, 57.2 KiB processed)[0m in 3.55s]
[0m19:21:54.134749 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_1_total_orders
[0m19:21:54.137742 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_2_orders_per_month
[0m19:21:54.141731 [info ] [Thread-1  ]: 6 of 10 START sql table model Astrafy_marts.ex_2_orders_per_month .............. [RUN]
[0m19:21:54.146267 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_1_total_orders, now model.Astrafy.ex_2_orders_per_month)
[0m19:21:54.149268 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_2_orders_per_month
[0m19:21:54.161356 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_2_orders_per_month"
[0m19:21:54.169304 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_2_orders_per_month
[0m19:21:54.178310 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:21:54.748501 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_2_orders_per_month"
[0m19:21:54.758640 [debug] [Thread-1  ]: On model.Astrafy.ex_2_orders_per_month: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_2_orders_per_month"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_2_orders_per_month`
      
    
    

    
    OPTIONS(
      description="""Monthly order volume for 2023."""
    )
    as (
      

-- Monthly order count for 2023
select
  extract(year from date_date) as year,
  extract(month from date_date) as month,
  count(distinct order_id) as orders_per_month
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
group by 1, 2
order by year, month
    );
  
[0m19:21:55.488482 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:cebb5f23-8e00-4dcb-abeb-9b18be8e311f&page=queryresults
[0m19:21:57.573936 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FF3337C0>]}
[0m19:21:57.575929 [info ] [Thread-1  ]: 6 of 10 OK created sql table model Astrafy_marts.ex_2_orders_per_month ......... [[32mCREATE TABLE (12.0 rows, 57.2 KiB processed)[0m in 3.43s]
[0m19:21:57.579843 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_2_orders_per_month
[0m19:21:57.581586 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_5_order_segmentation
[0m19:21:57.584943 [info ] [Thread-1  ]: 7 of 10 START sql table model Astrafy_marts.ex_5_order_segmentation ............ [RUN]
[0m19:21:57.587933 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_2_orders_per_month, now model.Astrafy.ex_5_order_segmentation)
[0m19:21:57.590925 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_5_order_segmentation
[0m19:21:57.600898 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_5_order_segmentation"
[0m19:21:57.607417 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_5_order_segmentation
[0m19:21:57.614405 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_5_order_segmentation"
[0m19:21:57.618802 [debug] [Thread-1  ]: On model.Astrafy.ex_5_order_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_5_order_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation`
      
    
    

    
    OPTIONS(
      description="""Segmentation of 2023 orders based on past 12-month purchase behavior."""
    )
    as (
      

-- Determine order segmentation (New, Returning, VIP)
with orders_with_lag as (
    select
        customer_id,
        order_id,
        date_date,
        count(order_id) over (
            partition by customer_id
            order by date_date
            range between interval 12 month preceding and current row
        ) as orders_last_12m
    from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
    where extract(year from date_date) = 2023
)
select
    customer_id,
    order_id,
    date_date,
    case
        when orders_last_12m = 1 then 'New'
        when orders_last_12m between 2 and 4 then 'Returning'
        when orders_last_12m >= 5 then 'VIP'
    end as order_segment
from orders_with_lag
    );
  
[0m19:21:57.624784 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:21:58.796653 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:71490dcb-4f81-4cde-9f55-053ece50d16d&page=queryresults
[0m19:21:58.971365 [error] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:71490dcb-4f81-4cde-9f55-053ece50d16d&page=queryresults
[0m19:21:58.994303 [debug] [Thread-1  ]: Database Error in model ex_5_order_segmentation (models\marts\ex_5_order_segmentation.sql)
  ORDER BY key must be numeric in a RANGE-based window with OFFSET PRECEDING or OFFSET FOLLOWING boundaries, but has type DATE at [26:13]
  compiled code at target\run\Astrafy\models\marts\ex_5_order_segmentation.sql
[0m19:21:58.996297 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FF480F10>]}
[0m19:21:58.999290 [error] [Thread-1  ]: 7 of 10 ERROR creating sql table model Astrafy_marts.ex_5_order_segmentation ... [[31mERROR[0m in 1.41s]
[0m19:21:59.003283 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_5_order_segmentation
[0m19:21:59.007270 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_3_avg_products_per_order
[0m19:21:59.010260 [debug] [Thread-4  ]: Marking all children of 'model.Astrafy.ex_5_order_segmentation' to be skipped because of status 'error'.  Reason: Database Error in model ex_5_order_segmentation (models\marts\ex_5_order_segmentation.sql)
  ORDER BY key must be numeric in a RANGE-based window with OFFSET PRECEDING or OFFSET FOLLOWING boundaries, but has type DATE at [26:13]
  compiled code at target\run\Astrafy\models\marts\ex_5_order_segmentation.sql.
[0m19:21:59.012254 [info ] [Thread-1  ]: 8 of 10 START sql table model Astrafy_marts.ex_3_avg_products_per_order ........ [RUN]
[0m19:21:59.018251 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_5_order_segmentation, now model.Astrafy.ex_3_avg_products_per_order)
[0m19:21:59.023232 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_3_avg_products_per_order
[0m19:21:59.036421 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_3_avg_products_per_order"
[0m19:21:59.042403 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_3_avg_products_per_order
[0m19:21:59.047391 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:21:59.546217 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_3_avg_products_per_order"
[0m19:21:59.552570 [debug] [Thread-1  ]: On model.Astrafy.ex_3_avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_3_avg_products_per_order"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_3_avg_products_per_order`
      
    
    

    
    OPTIONS(
      description="""Average number of distinct products per order per month in 2023."""
    )
    as (
      

-- Calculate average number of products per order for each month in 2023
with products_per_order as (
  select
    order_id,
    count(distinct product_id) as product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  where extract(year from date_date) = 2023
  group by order_id
),
orders_monthly as (
  select
    extract(month from s.date_date) as month,
    p.product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales` s
  join products_per_order p using (order_id)
  where extract(year from s.date_date) = 2023
)
select
  month,
  avg(product_count) as avg_products_per_order
from orders_monthly
group by month
order by month
    );
  
[0m19:22:00.308467 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:0757f0bc-3e63-4bbf-8eac-00dfa8ee924b&page=queryresults
[0m19:22:02.649391 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FF480970>]}
[0m19:22:02.650389 [info ] [Thread-1  ]: 8 of 10 OK created sql table model Astrafy_marts.ex_3_avg_products_per_order ... [[32mCREATE TABLE (12.0 rows, 664.7 KiB processed)[0m in 3.63s]
[0m19:22:02.652381 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_3_avg_products_per_order
[0m19:22:02.654377 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_4_orders_with_qty
[0m19:22:02.655374 [info ] [Thread-1  ]: 9 of 10 START sql table model Astrafy_marts.ex_4_orders_with_qty ............... [RUN]
[0m19:22:02.657368 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_3_avg_products_per_order, now model.Astrafy.ex_4_orders_with_qty)
[0m19:22:02.661381 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_4_orders_with_qty
[0m19:22:02.669337 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_4_orders_with_qty"
[0m19:22:02.673363 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_4_orders_with_qty
[0m19:22:02.682303 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:22:03.273126 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_4_orders_with_qty"
[0m19:22:03.280072 [debug] [Thread-1  ]: On model.Astrafy.ex_4_orders_with_qty: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_4_orders_with_qty"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_4_orders_with_qty`
      
    
    

    
    OPTIONS(
      description="""Orders for 2022\u20132023 with the total quantity of products in each order."""
    )
    as (
      

-- Table: one line per order, including product quantity
with product_counts as (
    select
        order_id,
        sum(qty) as qty_product
    from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
    where extract(year from date_date) in (2022, 2023)
    group by order_id
)
select
    o.date_date,
    o.customer_id,
    o.order_id,
    o.net_sales,
    p.qty_product
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o
left join product_counts p using (order_id)
where extract(year from o.date_date) in (2022, 2023)
    );
  
[0m19:22:04.435518 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:b63d1635-9073-4b75-83d3-658a5913efa7&page=queryresults
[0m19:22:07.040925 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3556522a-0f0d-4cb8-bf03-96677bdf8f2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FF472AF0>]}
[0m19:22:07.042889 [info ] [Thread-1  ]: 9 of 10 OK created sql table model Astrafy_marts.ex_4_orders_with_qty .......... [[32mCREATE TABLE (3.7k rows, 779.1 KiB processed)[0m in 4.38s]
[0m19:22:07.046909 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_4_orders_with_qty
[0m19:22:07.047906 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:22:07.049869 [info ] [Thread-1  ]: 10 of 10 SKIP relation Astrafy_marts.ex_6_orders_2023_with_segmentation ........ [[33mSKIP[0m]
[0m19:22:07.052867 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:22:07.055596 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:22:07.060581 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:22:07.062576 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2' was properly closed.
[0m19:22:07.064577 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy' was properly closed.
[0m19:22:07.066564 [debug] [MainThread]: Connection 'model.Astrafy.ex_4_orders_with_qty' was properly closed.
[0m19:22:07.069590 [info ] [MainThread]: 
[0m19:22:07.071552 [info ] [MainThread]: Finished running 7 table models, 3 view models in 0 hours 0 minutes and 30.51 seconds (30.51s).
[0m19:22:07.082550 [debug] [MainThread]: Command end result
[0m19:22:07.148373 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:22:07.154465 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:22:07.170555 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m19:22:07.171553 [info ] [MainThread]: 
[0m19:22:07.172549 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:22:07.173640 [info ] [MainThread]: 
[0m19:22:07.176039 [error] [MainThread]: [31mFailure in model ex_5_order_segmentation (models\marts\ex_5_order_segmentation.sql)[0m
[0m19:22:07.177503 [error] [MainThread]:   Database Error in model ex_5_order_segmentation (models\marts\ex_5_order_segmentation.sql)
  ORDER BY key must be numeric in a RANGE-based window with OFFSET PRECEDING or OFFSET FOLLOWING boundaries, but has type DATE at [26:13]
  compiled code at target\run\Astrafy\models\marts\ex_5_order_segmentation.sql
[0m19:22:07.179992 [info ] [MainThread]: 
[0m19:22:07.181986 [info ] [MainThread]:   compiled code at target\compiled\Astrafy\models\marts\ex_5_order_segmentation.sql
[0m19:22:07.185124 [info ] [MainThread]: 
[0m19:22:07.187106 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=10
[0m19:22:07.188798 [debug] [MainThread]: Command `dbt run` failed at 19:22:07.188798 after 37.76 seconds
[0m19:22:07.190825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2E941B970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2EB7000D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2FED77A00>]}
[0m19:22:07.191895 [debug] [MainThread]: Flushing usage events
[0m19:22:07.926480 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:24:01.250477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E0F07FB9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E0F2AB3F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E0F2AB3CA0>]}


============================== 19:24:01.259454 | 0762e39c-244a-4b87-9f8a-c2faa5c85616 ==============================
[0m19:24:01.259454 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:24:01.262320 [debug] [MainThread]: running dbt with arguments {'profiles_dir': 'C:\\Users\\perez\\.dbt', 'use_experimental_parser': 'False', 'warn_error': 'None', 'quiet': 'False', 'invocation_command': 'dbt run --select ex_5_order_segmentation', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:24:05.717153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0762e39c-244a-4b87-9f8a-c2faa5c85616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E0EEBD3850>]}
[0m19:24:05.826403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0762e39c-244a-4b87-9f8a-c2faa5c85616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E0859C9CD0>]}
[0m19:24:05.828366 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m19:24:06.922292 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:24:07.298312 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:24:07.300288 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\ex_5_order_segmentation.sql
[0m19:24:07.971674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0762e39c-244a-4b87-9f8a-c2faa5c85616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E0864FB130>]}
[0m19:24:08.234081 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:24:08.234081 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:24:08.283999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0762e39c-244a-4b87-9f8a-c2faa5c85616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E08651A0D0>]}
[0m19:24:08.283999 [info ] [MainThread]: Found 10 models, 4 data tests, 2 sources, 508 macros
[0m19:24:08.283999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0762e39c-244a-4b87-9f8a-c2faa5c85616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E08651C1C0>]}
[0m19:24:08.283999 [info ] [MainThread]: 
[0m19:24:08.300661 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:24:08.300661 [info ] [MainThread]: 
[0m19:24:08.300661 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:24:08.300661 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m19:24:08.300661 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:08.901444 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy_staging'
[0m19:24:08.901444 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:09.442854 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_staging, now list_sage-tribute-474816-g2_Astrafy)
[0m19:24:09.458512 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:09.998541 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy, now list_sage-tribute-474816-g2_Astrafy_marts)
[0m19:24:10.014202 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:10.625348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0762e39c-244a-4b87-9f8a-c2faa5c85616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E0862EB970>]}
[0m19:24:10.625348 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:24:10.641015 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_5_order_segmentation
[0m19:24:10.656596 [info ] [Thread-1  ]: 1 of 1 START sql table model Astrafy_marts.ex_5_order_segmentation ............. [RUN]
[0m19:24:10.656596 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.ex_5_order_segmentation'
[0m19:24:10.656596 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_5_order_segmentation
[0m19:24:10.687702 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_5_order_segmentation"
[0m19:24:10.687702 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_5_order_segmentation
[0m19:24:10.751557 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_5_order_segmentation"
[0m19:24:10.751557 [debug] [Thread-1  ]: On model.Astrafy.ex_5_order_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_5_order_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation`
      
    
    

    
    OPTIONS(
      description="""Segmentation of 2023 orders based on past 12-month purchase behavior."""
    )
    as (
      

-- Compute the number of past orders within 12 months for each order
with customer_orders as (
    select
        customer_id,
        order_id,
        date_date,
        -- Count how many previous orders (including current) in the last 12 months
        (
            select count(*)
            from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o2
            where o2.customer_id = o1.customer_id
              and o2.date_date between date_sub(o1.date_date, interval 12 month) and o1.date_date
        ) as orders_last_12m
    from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o1
    where extract(year from date_date) = 2023
)
select
    customer_id,
    order_id,
    date_date,
    case
        when orders_last_12m = 1 then 'New'
        when orders_last_12m between 2 and 4 then 'Returning'
        when orders_last_12m >= 5 then 'VIP'
    end as order_segment
from customer_orders
    );
  
[0m19:24:10.751557 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m19:24:11.835571 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:14812235-accd-4252-be90-ded81e6c2c68&page=queryresults
[0m19:24:14.613019 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0762e39c-244a-4b87-9f8a-c2faa5c85616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E08760B3D0>]}
[0m19:24:14.613019 [info ] [Thread-1  ]: 1 of 1 OK created sql table model Astrafy_marts.ex_5_order_segmentation ........ [[32mCREATE TABLE (2.6k rows, 85.8 KiB processed)[0m in 3.96s]
[0m19:24:14.613019 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_5_order_segmentation
[0m19:24:14.628642 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:24:14.628642 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:24:14.628642 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2' was properly closed.
[0m19:24:14.628642 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy_marts' was properly closed.
[0m19:24:14.628642 [debug] [MainThread]: Connection 'model.Astrafy.ex_5_order_segmentation' was properly closed.
[0m19:24:14.628642 [info ] [MainThread]: 
[0m19:24:14.645252 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.33 seconds (6.33s).
[0m19:24:14.647202 [debug] [MainThread]: Command end result
[0m19:24:14.836342 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:24:14.851960 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:24:14.867590 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m19:24:14.867590 [info ] [MainThread]: 
[0m19:24:14.867590 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:24:14.867590 [info ] [MainThread]: 
[0m19:24:14.867590 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m19:24:14.867590 [debug] [MainThread]: Command `dbt run` succeeded at 19:24:14.867590 after 13.79 seconds
[0m19:24:14.867590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E0F07FB9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E08651C640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E086550CD0>]}
[0m19:24:14.867590 [debug] [MainThread]: Flushing usage events
[0m19:24:15.474569 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:24:25.323260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5D237B9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5D4626430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5D46261C0>]}


============================== 19:24:25.338881 | a39222b4-c227-43c5-b6ad-ab29d8fea008 ==============================
[0m19:24:25.338881 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:24:25.338881 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'invocation_command': 'dbt run --select ex_6_orders_2023_with_segmentation', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'empty': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:24:29.435775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a39222b4-c227-43c5-b6ad-ab29d8fea008', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5E760E700>]}
[0m19:24:29.529539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a39222b4-c227-43c5-b6ad-ab29d8fea008', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5D3DB1520>]}
[0m19:24:29.529539 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m19:24:30.626304 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:24:30.984820 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:24:30.984820 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:24:31.083225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a39222b4-c227-43c5-b6ad-ab29d8fea008', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5E7D98130>]}
[0m19:24:31.270648 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:24:31.270648 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:24:31.317511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a39222b4-c227-43c5-b6ad-ab29d8fea008', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5E7D7C880>]}
[0m19:24:31.317511 [info ] [MainThread]: Found 10 models, 4 data tests, 2 sources, 508 macros
[0m19:24:31.317511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a39222b4-c227-43c5-b6ad-ab29d8fea008', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5E7DF1250>]}
[0m19:24:31.333165 [info ] [MainThread]: 
[0m19:24:31.333165 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:24:31.333165 [info ] [MainThread]: 
[0m19:24:31.338560 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:24:31.341622 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m19:24:31.341622 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:31.989986 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy_staging'
[0m19:24:31.989986 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:32.557785 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_staging, now list_sage-tribute-474816-g2_Astrafy)
[0m19:24:32.557785 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:33.076293 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy, now list_sage-tribute-474816-g2_Astrafy_marts)
[0m19:24:33.076293 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:33.656710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a39222b4-c227-43c5-b6ad-ab29d8fea008', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5E7D18820>]}
[0m19:24:33.672296 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:24:33.672296 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:24:33.672296 [info ] [Thread-1  ]: 1 of 1 START sql table model Astrafy_marts.ex_6_orders_2023_with_segmentation .. [RUN]
[0m19:24:33.672296 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.ex_6_orders_2023_with_segmentation'
[0m19:24:33.672296 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:24:33.687918 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_6_orders_2023_with_segmentation"
[0m19:24:33.706674 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:24:33.791659 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_6_orders_2023_with_segmentation"
[0m19:24:33.807277 [debug] [Thread-1  ]: On model.Astrafy.ex_6_orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_6_orders_2023_with_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_6_orders_2023_with_segmentation`
      
    
    

    
    OPTIONS(
      description="""2023 orders enriched with customer segmentation."""
    )
    as (
      

-- Merge all order details with segmentation
select
    o.date_date,
    o.customer_id,
    o.order_id,
    o.net_sales,
    s.order_segment
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o
left join `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation` s
    using (order_id, customer_id)
where extract(year from o.date_date) = 2023
    );
  
[0m19:24:33.807277 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m19:24:34.960125 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:77ca4858-9da5-4afe-85c4-601bb8a2a998&page=queryresults
[0m19:24:37.642480 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a39222b4-c227-43c5-b6ad-ab29d8fea008', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5E7EDE0A0>]}
[0m19:24:37.658104 [info ] [Thread-1  ]: 1 of 1 OK created sql table model Astrafy_marts.ex_6_orders_2023_with_segmentation  [[32mCREATE TABLE (2.6k rows, 171.9 KiB processed)[0m in 3.97s]
[0m19:24:37.658104 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:24:37.658104 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:24:37.658104 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:24:37.658104 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2' was properly closed.
[0m19:24:37.658104 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy_marts' was properly closed.
[0m19:24:37.658104 [debug] [MainThread]: Connection 'model.Astrafy.ex_6_orders_2023_with_segmentation' was properly closed.
[0m19:24:37.658104 [info ] [MainThread]: 
[0m19:24:37.673986 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.32 seconds (6.32s).
[0m19:24:37.676206 [debug] [MainThread]: Command end result
[0m19:24:37.731713 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:24:37.731713 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:24:37.747986 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m19:24:37.747986 [info ] [MainThread]: 
[0m19:24:37.747986 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:24:37.747986 [info ] [MainThread]: 
[0m19:24:37.763439 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m19:24:37.766559 [debug] [MainThread]: Command `dbt run` succeeded at 19:24:37.766559 after 12.55 seconds
[0m19:24:37.768586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5D237B9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5D3DB1520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B5D36F34C0>]}
[0m19:24:37.769550 [debug] [MainThread]: Flushing usage events
[0m19:24:38.300855 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:28:33.413378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232F363B9D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232F58F3EB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232F58F3C40>]}


============================== 19:28:33.413378 | fb8e2be2-1cd9-4ede-86cd-3173c313fe3f ==============================
[0m19:28:33.413378 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m19:28:33.413378 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'invocation_command': 'dbt run --select ex_5_order_segmentation ex_6_orders_2023_with_segmentation', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m19:28:37.462446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb8e2be2-1cd9-4ede-86cd-3173c313fe3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232888D2CA0>]}
[0m19:28:37.556175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb8e2be2-1cd9-4ede-86cd-3173c313fe3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232F51C9C10>]}
[0m19:28:37.556175 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m19:28:38.656192 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m19:28:39.017124 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:28:39.017124 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:28:39.110884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb8e2be2-1cd9-4ede-86cd-3173c313fe3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002328907EE20>]}
[0m19:28:39.329553 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:28:39.345175 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:28:39.407657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb8e2be2-1cd9-4ede-86cd-3173c313fe3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023288FC1340>]}
[0m19:28:39.407657 [info ] [MainThread]: Found 10 models, 4 data tests, 2 sources, 508 macros
[0m19:28:39.407657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb8e2be2-1cd9-4ede-86cd-3173c313fe3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023288F9A370>]}
[0m19:28:39.407657 [info ] [MainThread]: 
[0m19:28:39.419904 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:28:39.421899 [info ] [MainThread]: 
[0m19:28:39.424890 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:28:39.433866 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m19:28:39.435861 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:28:40.016304 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy'
[0m19:28:40.019295 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:28:40.633567 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy, now list_sage-tribute-474816-g2_Astrafy_staging)
[0m19:28:40.633567 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:28:41.214080 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_staging, now list_sage-tribute-474816-g2_Astrafy_marts)
[0m19:28:41.214080 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:28:41.732434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb8e2be2-1cd9-4ede-86cd-3173c313fe3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023289093550>]}
[0m19:28:41.732434 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:28:41.747971 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_5_order_segmentation
[0m19:28:41.747971 [info ] [Thread-1  ]: 1 of 2 START sql table model Astrafy_marts.ex_5_order_segmentation ............. [RUN]
[0m19:28:41.747971 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.ex_5_order_segmentation'
[0m19:28:41.747971 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_5_order_segmentation
[0m19:28:41.774699 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_5_order_segmentation"
[0m19:28:41.774699 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_5_order_segmentation
[0m19:28:41.808696 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m19:28:42.398786 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_5_order_segmentation"
[0m19:28:42.398786 [debug] [Thread-1  ]: On model.Astrafy.ex_5_order_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_5_order_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation`
      
    
    

    
    OPTIONS(
      description="""Segmentation of 2023 orders based on past 12-month purchase behavior."""
    )
    as (
      

-- Compute the number of past orders within 12 months for each order
with customer_orders as (
    select
        customer_id,
        order_id,
        date_date,
        -- Count how many previous orders (including current) in the last 12 months
        (
            select count(*)
            from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o2
            where o2.customer_id = o1.customer_id
              and o2.date_date between date_sub(o1.date_date, interval 12 month) and o1.date_date
        ) as orders_last_12m
    from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o1
    where extract(year from date_date) = 2023
)
select
    customer_id,
    order_id,
    date_date,
    case
        when orders_last_12m = 1 then 'New'
        when orders_last_12m between 2 and 4 then 'Returning'
        when orders_last_12m >= 5 then 'VIP'
    end as order_segment
from customer_orders
    );
  
[0m19:28:42.992323 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:31c0c3cd-2dd4-4e72-9ce3-9892f726bf21&page=queryresults
[0m19:28:46.019296 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb8e2be2-1cd9-4ede-86cd-3173c313fe3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232891C2580>]}
[0m19:28:46.019296 [info ] [Thread-1  ]: 1 of 2 OK created sql table model Astrafy_marts.ex_5_order_segmentation ........ [[32mCREATE TABLE (2.6k rows, 85.8 KiB processed)[0m in 4.26s]
[0m19:28:46.019296 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_5_order_segmentation
[0m19:28:46.019296 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:28:46.037667 [info ] [Thread-1  ]: 2 of 2 START sql table model Astrafy_marts.ex_6_orders_2023_with_segmentation .. [RUN]
[0m19:28:46.039664 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_5_order_segmentation, now model.Astrafy.ex_6_orders_2023_with_segmentation)
[0m19:28:46.042685 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:28:46.044404 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_6_orders_2023_with_segmentation"
[0m19:28:46.044404 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:28:46.061463 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m19:28:46.579228 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_6_orders_2023_with_segmentation"
[0m19:28:46.596031 [debug] [Thread-1  ]: On model.Astrafy.ex_6_orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_6_orders_2023_with_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_6_orders_2023_with_segmentation`
      
    
    

    
    OPTIONS(
      description="""2023 orders enriched with customer segmentation."""
    )
    as (
      

-- Merge all order details with segmentation
select
    o.date_date,
    o.customer_id,
    o.order_id,
    o.net_sales,
    s.order_segment
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o
left join `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation` s
    using (order_id, customer_id)
where extract(year from o.date_date) = 2023
    );
  
[0m19:28:47.441145 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:1f78fc96-11ed-4565-b7f8-ee1ef06d7966&page=queryresults
[0m19:28:50.270451 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb8e2be2-1cd9-4ede-86cd-3173c313fe3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232F3537700>]}
[0m19:28:50.270451 [info ] [Thread-1  ]: 2 of 2 OK created sql table model Astrafy_marts.ex_6_orders_2023_with_segmentation  [[32mCREATE TABLE (2.6k rows, 171.9 KiB processed)[0m in 4.23s]
[0m19:28:50.286118 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m19:28:50.286118 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:28:50.306231 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:28:50.311162 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2' was properly closed.
[0m19:28:50.318105 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy_marts' was properly closed.
[0m19:28:50.320094 [debug] [MainThread]: Connection 'model.Astrafy.ex_6_orders_2023_with_segmentation' was properly closed.
[0m19:28:50.322088 [info ] [MainThread]: 
[0m19:28:50.324081 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 10.90 seconds (10.90s).
[0m19:28:50.326132 [debug] [MainThread]: Command end result
[0m19:28:50.383409 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m19:28:50.399778 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m19:28:50.416064 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m19:28:50.417057 [info ] [MainThread]: 
[0m19:28:50.418055 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:28:50.419183 [info ] [MainThread]: 
[0m19:28:50.419183 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m19:28:50.419183 [debug] [MainThread]: Command `dbt run` succeeded at 19:28:50.419183 after 17.13 seconds
[0m19:28:50.419183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232F363B9D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232F49A9CA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232F51C9C10>]}
[0m19:28:50.419183 [debug] [MainThread]: Flushing usage events
[0m19:28:50.972278 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:35:32.104778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028BDC9AB9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028BDEC543A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028BDEC54130>]}


============================== 17:35:32.113464 | b2480ca7-8a54-4781-b0ab-1091486e0348 ==============================
[0m17:35:32.113464 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m17:35:32.115466 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'use_experimental_parser': 'False', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'invocation_command': 'dbt debug', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'None', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m17:35:32.187125 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m17:35:32.189119 [info ] [MainThread]: python version: 3.9.13
[0m17:35:32.190115 [info ] [MainThread]: python path: C:\bigquery\dbt-core\Scripts\python.exe
[0m17:35:32.192110 [info ] [MainThread]: os info: Windows-10-10.0.19045-SP0
[0m17:35:40.924758 [info ] [MainThread]: Using profiles dir at C:\Users\perez\.dbt
[0m17:35:40.939894 [info ] [MainThread]: Using profiles.yml file at C:\Users\perez\.dbt\profiles.yml
[0m17:35:40.941887 [info ] [MainThread]: Using dbt_project.yml file at C:\bigquery\dbt-core\Astrafy\dbt_project.yml
[0m17:35:40.943061 [info ] [MainThread]: adapter type: bigquery
[0m17:35:40.945549 [info ] [MainThread]: adapter version: 1.10.2
[0m17:35:41.155571 [info ] [MainThread]: Configuration:
[0m17:35:41.155571 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m17:35:41.155571 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m17:35:41.155571 [info ] [MainThread]: Required dependencies:
[0m17:35:41.155571 [debug] [MainThread]: Executing "git --help"
[0m17:35:41.243039 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m17:35:41.244262 [debug] [MainThread]: STDERR: "b''"
[0m17:35:41.245264 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m17:35:41.246261 [info ] [MainThread]: Connection:
[0m17:35:41.247260 [info ] [MainThread]:   method: service-account
[0m17:35:41.248296 [info ] [MainThread]:   database: sage-tribute-474816-g2
[0m17:35:41.250250 [info ] [MainThread]:   execution_project: sage-tribute-474816-g2
[0m17:35:41.251927 [info ] [MainThread]:   schema: Astrafy
[0m17:35:41.252995 [info ] [MainThread]:   location: EU
[0m17:35:41.253995 [info ] [MainThread]:   priority: interactive
[0m17:35:41.255870 [info ] [MainThread]:   maximum_bytes_billed: None
[0m17:35:41.256702 [info ] [MainThread]:   impersonate_service_account: None
[0m17:35:41.258026 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m17:35:41.258026 [info ] [MainThread]:   job_retries: 1
[0m17:35:41.258026 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m17:35:41.258026 [info ] [MainThread]:   job_execution_timeout_seconds: 200
[0m17:35:41.258026 [info ] [MainThread]:   timeout_seconds: 200
[0m17:35:41.258026 [info ] [MainThread]:   client_id: None
[0m17:35:41.258026 [info ] [MainThread]:   token_uri: None
[0m17:35:41.258026 [info ] [MainThread]:   compute_region: None
[0m17:35:41.258026 [info ] [MainThread]:   dataproc_cluster_name: None
[0m17:35:41.273208 [info ] [MainThread]:   gcs_bucket: None
[0m17:35:41.275709 [info ] [MainThread]:   dataproc_batch: None
[0m17:35:41.275709 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m17:35:42.374206 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m17:35:42.374206 [debug] [MainThread]: On debug: select 1 as id
[0m17:35:42.374206 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:35:43.723527 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:a0683060-a710-4cd1-8a29-a5958301a284&page=queryresults
[0m17:35:44.570408 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m17:35:44.577551 [info ] [MainThread]: [32mAll checks passed![0m
[0m17:35:44.577551 [debug] [MainThread]: Command `dbt debug` succeeded at 17:35:44.577551 after 12.64 seconds
[0m17:35:44.577551 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m17:35:44.577551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028BDC9AB9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028BF1D220A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028BF1D899A0>]}
[0m17:35:44.577551 [debug] [MainThread]: Flushing usage events
[0m17:35:45.193547 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:36:02.922197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE463EB8B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE486A1DF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE486A1B80>]}


============================== 17:36:02.937821 | 6ef1b6be-15a4-4844-aba2-12ee86c9c489 ==============================
[0m17:36:02.937821 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m17:36:02.937821 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'partial_parse': 'True', 'quiet': 'False', 'warn_error': 'None', 'invocation_command': 'dbt build', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m17:36:07.296501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE5B7A9250>]}
[0m17:36:07.387189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE47E212B0>]}
[0m17:36:07.387189 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m17:36:08.535496 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m17:36:09.020025 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 5 files changed.
[0m17:36:09.020025 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\schema.yml
[0m17:36:09.020025 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\ex_4_orders_with_qty.sql
[0m17:36:09.020025 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\ex_3_avg_products_per_order.sql
[0m17:36:09.020025 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\ex_6_orders_2023_with_segmentation.sql
[0m17:36:09.020025 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\ex_5_order_segmentation.sql
[0m17:36:09.822014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE5C0D4130>]}
[0m17:36:10.054112 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m17:36:10.069733 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m17:36:10.297793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE5C0BE7C0>]}
[0m17:36:10.297793 [info ] [MainThread]: Found 10 models, 4 data tests, 2 sources, 508 macros
[0m17:36:10.297793 [info ] [MainThread]: 
[0m17:36:10.307867 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:36:10.309575 [info ] [MainThread]: 
[0m17:36:10.311569 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:36:10.322771 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m17:36:10.322771 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:36:10.816085 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:36:11.288172 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:36:11.825672 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy'
[0m17:36:11.841366 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:36:12.389337 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy, now list_sage-tribute-474816-g2_Astrafy_staging)
[0m17:36:12.404864 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:36:12.928143 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_staging, now list_sage-tribute-474816-g2_Astrafy_marts)
[0m17:36:12.928143 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:36:13.475533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE5BF03580>]}
[0m17:36:13.475533 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:36:13.515891 [debug] [Thread-1  ]: Began running node model.Astrafy.my_first_dbt_model
[0m17:36:13.517938 [info ] [Thread-1  ]: 1 of 14 START sql table model Astrafy.my_first_dbt_model ....................... [RUN]
[0m17:36:13.520929 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.my_first_dbt_model'
[0m17:36:13.523920 [debug] [Thread-1  ]: Began compiling node model.Astrafy.my_first_dbt_model
[0m17:36:13.531957 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.my_first_dbt_model"
[0m17:36:13.552850 [debug] [Thread-1  ]: Began executing node model.Astrafy.my_first_dbt_model
[0m17:36:13.571909 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:36:14.139281 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.my_first_dbt_model"
[0m17:36:14.156128 [debug] [Thread-1  ]: On model.Astrafy.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.my_first_dbt_model"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
      
    
    

    
    OPTIONS(
      description="""A starter dbt model"""
    )
    as (
      /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
    );
  
[0m17:36:14.630874 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:3f5d9645-0a21-4be2-8ca3-3208339a6182&page=queryresults
[0m17:36:17.297150 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE555AFBB0>]}
[0m17:36:17.312724 [info ] [Thread-1  ]: 1 of 14 OK created sql table model Astrafy.my_first_dbt_model .................. [[32mCREATE TABLE (2.0 rows, 0 processed)[0m in 3.78s]
[0m17:36:17.312724 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_first_dbt_model
[0m17:36:17.312724 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_orders
[0m17:36:17.312724 [info ] [Thread-1  ]: 2 of 14 START sql view model Astrafy_staging.stg_orders ........................ [RUN]
[0m17:36:17.325677 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.my_first_dbt_model, now model.Astrafy.stg_orders)
[0m17:36:17.328669 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_orders
[0m17:36:17.488530 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_orders"
[0m17:36:17.491970 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_orders
[0m17:36:17.528443 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_orders"
[0m17:36:17.531900 [debug] [Thread-1  ]: On model.Astrafy.stg_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_orders"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
  OPTIONS(
      description="""Cleaned and normalized orders table."""
    )
  as 

-- Clean and normalize the orders table
select
  date_date,
  cast(customers_id as int64) as customer_id,
  cast(orders_id as int64) as order_id,
  cast(net_sales as float64) as net_sales
from `sage-tribute-474816-g2`.`Astrafy`.`orders_recrutement`
where date_date is not null;


[0m17:36:17.532902 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:36:18.296776 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:035fabbf-5f1e-4578-a17d-a603cf51f267&page=queryresults
[0m17:36:19.205766 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE477A7700>]}
[0m17:36:19.205766 [info ] [Thread-1  ]: 2 of 14 OK created sql view model Astrafy_staging.stg_orders ................... [[32mCREATE VIEW (0 processed)[0m in 1.88s]
[0m17:36:19.205766 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_orders
[0m17:36:19.205766 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_sales
[0m17:36:19.205766 [info ] [Thread-1  ]: 3 of 14 START sql view model Astrafy_staging.stg_sales ......................... [RUN]
[0m17:36:19.222242 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_orders, now model.Astrafy.stg_sales)
[0m17:36:19.225237 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_sales
[0m17:36:19.249714 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_sales"
[0m17:36:19.256997 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_sales
[0m17:36:19.267098 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_sales"
[0m17:36:19.270931 [debug] [Thread-1  ]: On model.Astrafy.stg_sales: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_sales"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  OPTIONS(
      description="""Cleaned and normalized sales table with product-level details."""
    )
  as 

-- Clean and normalize the sales table
select
  date_date,
  cast(customer_id as int64) as customer_id,
  cast(order_id as int64) as order_id,
  cast(products_id as int64) as product_id,
  cast(net_sales as float64) as net_sales,
  cast(qty as int64) as qty
from `sage-tribute-474816-g2`.`Astrafy`.`sales_recrutement`
where date_date is not null;


[0m17:36:19.272929 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:36:20.013383 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:06a50987-df0b-48b2-8ffa-fe27106d86ee&page=queryresults
[0m17:36:20.892698 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE5C2FF220>]}
[0m17:36:20.908186 [info ] [Thread-1  ]: 3 of 14 OK created sql view model Astrafy_staging.stg_sales .................... [[32mCREATE VIEW (0 processed)[0m in 1.67s]
[0m17:36:20.908186 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_sales
[0m17:36:20.908186 [debug] [Thread-1  ]: Began running node test.Astrafy.not_null_my_first_dbt_model_id.5fb22c2710
[0m17:36:20.908186 [info ] [Thread-1  ]: 4 of 14 START test not_null_my_first_dbt_model_id .............................. [RUN]
[0m17:36:20.923802 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_sales, now test.Astrafy.not_null_my_first_dbt_model_id.5fb22c2710)
[0m17:36:20.930158 [debug] [Thread-1  ]: Began compiling node test.Astrafy.not_null_my_first_dbt_model_id.5fb22c2710
[0m17:36:20.967064 [debug] [Thread-1  ]: Writing injected SQL for node "test.Astrafy.not_null_my_first_dbt_model_id.5fb22c2710"
[0m17:36:20.969711 [debug] [Thread-1  ]: Began executing node test.Astrafy.not_null_my_first_dbt_model_id.5fb22c2710
[0m17:36:21.012655 [debug] [Thread-1  ]: Writing runtime sql for node "test.Astrafy.not_null_my_first_dbt_model_id.5fb22c2710"
[0m17:36:21.012655 [debug] [Thread-1  ]: On test.Astrafy.not_null_my_first_dbt_model_id.5fb22c2710: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "test.Astrafy.not_null_my_first_dbt_model_id.5fb22c2710"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select id
from `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
where id is null



  
  
      
    ) dbt_internal_test
[0m17:36:21.012655 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:36:21.814043 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:3856915a-8568-4945-99a8-3399aa6d3375&page=queryresults
[0m17:36:22.320207 [error] [Thread-1  ]: 4 of 14 FAIL 1 not_null_my_first_dbt_model_id .................................. [[31mFAIL 1[0m in 1.40s]
[0m17:36:22.323464 [debug] [Thread-1  ]: Finished running node test.Astrafy.not_null_my_first_dbt_model_id.5fb22c2710
[0m17:36:22.325454 [debug] [Thread-1  ]: Began running node test.Astrafy.unique_my_first_dbt_model_id.16e066b321
[0m17:36:22.327549 [debug] [Thread-4  ]: Marking all children of 'test.Astrafy.not_null_my_first_dbt_model_id.5fb22c2710' to be skipped because of status 'fail'.  Reason: Got 1 result, configured to fail if != 0.
[0m17:36:22.327549 [info ] [Thread-1  ]: 5 of 14 START test unique_my_first_dbt_model_id ................................ [RUN]
[0m17:36:22.333755 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.Astrafy.not_null_my_first_dbt_model_id.5fb22c2710, now test.Astrafy.unique_my_first_dbt_model_id.16e066b321)
[0m17:36:22.336770 [debug] [Thread-1  ]: Began compiling node test.Astrafy.unique_my_first_dbt_model_id.16e066b321
[0m17:36:22.351033 [debug] [Thread-1  ]: Writing injected SQL for node "test.Astrafy.unique_my_first_dbt_model_id.16e066b321"
[0m17:36:22.363611 [debug] [Thread-1  ]: Began executing node test.Astrafy.unique_my_first_dbt_model_id.16e066b321
[0m17:36:22.364911 [debug] [Thread-1  ]: Writing runtime sql for node "test.Astrafy.unique_my_first_dbt_model_id.16e066b321"
[0m17:36:22.364911 [debug] [Thread-1  ]: On test.Astrafy.unique_my_first_dbt_model_id.16e066b321: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "test.Astrafy.unique_my_first_dbt_model_id.16e066b321"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with dbt_test__target as (

  select id as unique_field
  from `sage-tribute-474816-g2`.`Astrafy`.`my_first_dbt_model`
  where id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m17:36:22.364911 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:36:23.366055 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:7b8bd0fc-aa0f-4211-9e09-0794e596ae04&page=queryresults
[0m17:36:23.854359 [info ] [Thread-1  ]: 5 of 14 PASS unique_my_first_dbt_model_id ...................................... [[32mPASS[0m in 1.52s]
[0m17:36:23.860458 [debug] [Thread-1  ]: Finished running node test.Astrafy.unique_my_first_dbt_model_id.16e066b321
[0m17:36:23.860458 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_1_total_orders
[0m17:36:23.860458 [info ] [Thread-1  ]: 6 of 14 START sql table model Astrafy_marts.ex_1_total_orders .................. [RUN]
[0m17:36:23.878383 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.Astrafy.unique_my_first_dbt_model_id.16e066b321, now model.Astrafy.ex_1_total_orders)
[0m17:36:23.882594 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_1_total_orders
[0m17:36:23.899443 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_1_total_orders"
[0m17:36:23.915918 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_1_total_orders
[0m17:36:23.915918 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:36:24.352826 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_1_total_orders"
[0m17:36:24.368473 [debug] [Thread-1  ]: On model.Astrafy.ex_1_total_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_1_total_orders"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_1_total_orders`
      
    
    

    
    OPTIONS(
      description="""Total number of unique orders placed in 2023."""
    )
    as (
      

-- Total number of unique orders placed in 2023
select
  count(distinct order_id) as total_orders_2023
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
    );
  
[0m17:36:25.087085 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:43df170d-4353-45c4-8763-0eb7962811f7&page=queryresults
[0m17:36:26.957071 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE555A0760>]}
[0m17:36:26.957071 [info ] [Thread-1  ]: 6 of 14 OK created sql table model Astrafy_marts.ex_1_total_orders ............. [[32mCREATE TABLE (1.0 rows, 57.2 KiB processed)[0m in 3.08s]
[0m17:36:26.957071 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_1_total_orders
[0m17:36:26.973200 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_2_orders_per_month
[0m17:36:26.978228 [info ] [Thread-1  ]: 7 of 14 START sql table model Astrafy_marts.ex_2_orders_per_month .............. [RUN]
[0m17:36:26.983174 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_1_total_orders, now model.Astrafy.ex_2_orders_per_month)
[0m17:36:26.986170 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_2_orders_per_month
[0m17:36:27.002001 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_2_orders_per_month"
[0m17:36:27.002001 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_2_orders_per_month
[0m17:36:27.002001 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:36:27.507323 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_2_orders_per_month"
[0m17:36:27.513306 [debug] [Thread-1  ]: On model.Astrafy.ex_2_orders_per_month: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_2_orders_per_month"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_2_orders_per_month`
      
    
    

    
    OPTIONS(
      description="""Monthly order volume for 2023."""
    )
    as (
      

-- Monthly order count for 2023
select
  extract(year from date_date) as year,
  extract(month from date_date) as month,
  count(distinct order_id) as orders_per_month
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
group by 1, 2
order by year, month
    );
  
[0m17:36:28.258804 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:aa6ddf94-8c08-4335-afb7-98e94e038657&page=queryresults
[0m17:36:30.209538 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE477A7700>]}
[0m17:36:30.225157 [info ] [Thread-1  ]: 7 of 14 OK created sql table model Astrafy_marts.ex_2_orders_per_month ......... [[32mCREATE TABLE (12.0 rows, 57.2 KiB processed)[0m in 3.23s]
[0m17:36:30.241496 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_2_orders_per_month
[0m17:36:30.242817 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_5_order_segmentation
[0m17:36:30.242817 [info ] [Thread-1  ]: 8 of 14 START sql table model Astrafy_marts.ex_5_order_segmentation ............ [RUN]
[0m17:36:30.242817 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_2_orders_per_month, now model.Astrafy.ex_5_order_segmentation)
[0m17:36:30.254949 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_5_order_segmentation
[0m17:36:30.264806 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_5_order_segmentation"
[0m17:36:30.274387 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_5_order_segmentation
[0m17:36:30.274387 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:36:30.725620 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_5_order_segmentation"
[0m17:36:30.741216 [debug] [Thread-1  ]: On model.Astrafy.ex_5_order_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_5_order_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation`
      
    
    

    
    OPTIONS(
      description="""Customer segmentation: New / Returning / VIP for 2023."""
    )
    as (
      

-- Customer segmentation based on number of orders in the past 12 months
with customer_orders as (
    select
        customer_id,
        order_id,
        date_date,
        (
            select count(*)
            from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o2
            where o2.customer_id = o1.customer_id
              and o2.date_date between date_sub(o1.date_date, interval 12 month) and o1.date_date
        ) as orders_last_12m
    from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o1
    where extract(year from date_date) = 2023
)
select
    customer_id,
    order_id,
    date_date,
    case
        when orders_last_12m = 1 then 'New'
        when orders_last_12m between 2 and 4 then 'Returning'
        when orders_last_12m >= 5 then 'VIP'
    end as order_segment
from customer_orders
    );
  
[0m17:36:31.481342 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:2559f034-bee1-4703-883b-a839ecffe233&page=queryresults
[0m17:36:33.921590 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE5D302790>]}
[0m17:36:33.921590 [info ] [Thread-1  ]: 8 of 14 OK created sql table model Astrafy_marts.ex_5_order_segmentation ....... [[32mCREATE TABLE (2.6k rows, 85.8 KiB processed)[0m in 3.68s]
[0m17:36:33.939250 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_5_order_segmentation
[0m17:36:33.941857 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_3_avg_products_per_order
[0m17:36:33.943852 [info ] [Thread-1  ]: 9 of 14 START sql table model Astrafy_marts.ex_3_avg_products_per_order ........ [RUN]
[0m17:36:33.945936 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_5_order_segmentation, now model.Astrafy.ex_3_avg_products_per_order)
[0m17:36:33.948088 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_3_avg_products_per_order
[0m17:36:33.959363 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_3_avg_products_per_order"
[0m17:36:33.968333 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_3_avg_products_per_order
[0m17:36:33.973943 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:36:34.494506 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_3_avg_products_per_order"
[0m17:36:34.494506 [debug] [Thread-1  ]: On model.Astrafy.ex_3_avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_3_avg_products_per_order"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_3_avg_products_per_order`
      
    
    

    
    OPTIONS(
      description="""Average number of products per order for each month in 2023."""
    )
    as (
      

-- Average number of products per order for each month in 2023
with products_per_order as (
  select
    order_id,
    count(distinct product_id) as product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  where extract(year from date_date) = 2023
  group by order_id
),
orders_monthly as (
  select
    extract(month from s.date_date) as month,
    p.product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales` s
  join products_per_order p using (order_id)
  where extract(year from s.date_date) = 2023
)
select
  month,
  avg(product_count) as avg_products_per_order
from orders_monthly
group by month
order by month
    );
  
[0m17:36:35.329919 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:4a74c2e0-a98d-4fca-a904-abd651cf53ae&page=queryresults
[0m17:36:37.512463 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE5D302790>]}
[0m17:36:37.512463 [info ] [Thread-1  ]: 9 of 14 OK created sql table model Astrafy_marts.ex_3_avg_products_per_order ... [[32mCREATE TABLE (12.0 rows, 664.7 KiB processed)[0m in 3.57s]
[0m17:36:37.512463 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_3_avg_products_per_order
[0m17:36:37.512463 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_4_orders_with_qty
[0m17:36:37.512463 [info ] [Thread-1  ]: 10 of 14 START sql table model Astrafy_marts.ex_4_orders_with_qty .............. [RUN]
[0m17:36:37.512463 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_3_avg_products_per_order, now model.Astrafy.ex_4_orders_with_qty)
[0m17:36:37.512463 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_4_orders_with_qty
[0m17:36:37.531742 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_4_orders_with_qty"
[0m17:36:37.536731 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_4_orders_with_qty
[0m17:36:37.541715 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:36:37.964581 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_4_orders_with_qty"
[0m17:36:37.964581 [debug] [Thread-1  ]: On model.Astrafy.ex_4_orders_with_qty: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_4_orders_with_qty"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_4_orders_with_qty`
      
    
    

    
    OPTIONS(
      description="""Orders for 2022\u20132023 with total quantity of products per order."""
    )
    as (
      

-- Orders (2022–2023) with total quantity of products per order
with product_counts as (
    select
        order_id,
        sum(qty) as qty_product
    from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
    where extract(year from date_date) in (2022, 2023)
    group by order_id
)
select
    o.date_date,
    o.customer_id,
    o.order_id,
    o.net_sales,
    p.qty_product
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o
left join product_counts p using (order_id)
where extract(year from o.date_date) in (2022, 2023)
    );
  
[0m17:36:39.110112 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:aaff56fa-2d53-48bb-b08e-ee7ec25330af&page=queryresults
[0m17:36:41.144950 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE5BC910D0>]}
[0m17:36:41.152032 [info ] [Thread-1  ]: 10 of 14 OK created sql table model Astrafy_marts.ex_4_orders_with_qty ......... [[32mCREATE TABLE (3.7k rows, 779.1 KiB processed)[0m in 3.63s]
[0m17:36:41.159013 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_4_orders_with_qty
[0m17:36:41.164003 [debug] [Thread-1  ]: Began running node model.Astrafy.my_second_dbt_model
[0m17:36:41.170942 [info ] [Thread-1  ]: 11 of 14 SKIP relation Astrafy.my_second_dbt_model ............................. [[33mSKIP[0m]
[0m17:36:41.174931 [debug] [Thread-1  ]: Finished running node model.Astrafy.my_second_dbt_model
[0m17:36:41.179918 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m17:36:41.186900 [debug] [Thread-4  ]: Marking all children of 'model.Astrafy.my_second_dbt_model' to be skipped because of status 'skipped'. 
[0m17:36:41.188833 [info ] [Thread-1  ]: 12 of 14 START sql table model Astrafy_marts.ex_6_orders_2023_with_segmentation  [RUN]
[0m17:36:41.188833 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_4_orders_with_qty, now model.Astrafy.ex_6_orders_2023_with_segmentation)
[0m17:36:41.188833 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m17:36:41.204850 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_6_orders_2023_with_segmentation"
[0m17:36:41.204850 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m17:36:41.220902 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:36:41.724633 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_6_orders_2023_with_segmentation"
[0m17:36:41.734639 [debug] [Thread-1  ]: On model.Astrafy.ex_6_orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_6_orders_2023_with_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_6_orders_2023_with_segmentation`
      
    
    

    
    OPTIONS(
      description="""Final 2023 orders table enriched with segmentation."""
    )
    as (
      

-- 2023 orders with customer segmentation
select
    o.date_date,
    o.customer_id,
    o.order_id,
    o.net_sales,
    s.order_segment
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o
left join `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation` s
    using (order_id, customer_id)
where extract(year from o.date_date) = 2023
    );
  
[0m17:36:42.494595 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:f8b05011-da54-41c1-87a6-e07f6dedda0c&page=queryresults
[0m17:36:44.746275 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef1b6be-15a4-4844-aba2-12ee86c9c489', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE5BC910D0>]}
[0m17:36:44.750576 [info ] [Thread-1  ]: 12 of 14 OK created sql table model Astrafy_marts.ex_6_orders_2023_with_segmentation  [[32mCREATE TABLE (2.6k rows, 171.9 KiB processed)[0m in 3.56s]
[0m17:36:44.756560 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m17:36:44.760550 [debug] [Thread-1  ]: Began running node test.Astrafy.not_null_my_second_dbt_model_id.151b76d778
[0m17:36:44.763549 [info ] [Thread-1  ]: 13 of 14 SKIP test not_null_my_second_dbt_model_id ............................. [[33mSKIP[0m]
[0m17:36:44.769707 [debug] [Thread-1  ]: Finished running node test.Astrafy.not_null_my_second_dbt_model_id.151b76d778
[0m17:36:44.773928 [debug] [Thread-1  ]: Began running node test.Astrafy.unique_my_second_dbt_model_id.57a0f8c493
[0m17:36:44.776105 [debug] [Thread-4  ]: Marking all children of 'test.Astrafy.not_null_my_second_dbt_model_id.151b76d778' to be skipped because of status 'skipped'. 
[0m17:36:44.777836 [info ] [Thread-1  ]: 14 of 14 SKIP test unique_my_second_dbt_model_id ............................... [[33mSKIP[0m]
[0m17:36:44.787876 [debug] [Thread-1  ]: Finished running node test.Astrafy.unique_my_second_dbt_model_id.57a0f8c493
[0m17:36:44.787876 [debug] [Thread-4  ]: Marking all children of 'test.Astrafy.unique_my_second_dbt_model_id.57a0f8c493' to be skipped because of status 'skipped'. 
[0m17:36:44.787876 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:36:44.803388 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:36:44.803388 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2' was properly closed.
[0m17:36:44.803388 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy_marts' was properly closed.
[0m17:36:44.803388 [debug] [MainThread]: Connection 'model.Astrafy.ex_6_orders_2023_with_segmentation' was properly closed.
[0m17:36:44.803388 [info ] [MainThread]: 
[0m17:36:44.803388 [info ] [MainThread]: Finished running 7 table models, 4 data tests, 3 view models in 0 hours 0 minutes and 34.49 seconds (34.49s).
[0m17:36:44.824845 [debug] [MainThread]: Command end result
[0m17:36:44.891520 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m17:36:44.903211 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m17:36:44.921971 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m17:36:44.922971 [info ] [MainThread]: 
[0m17:36:44.923971 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m17:36:44.924996 [info ] [MainThread]: 
[0m17:36:44.926297 [error] [MainThread]: [31mFailure in test not_null_my_first_dbt_model_id (models\example\schema.yml)[0m
[0m17:36:44.928608 [error] [MainThread]:   Got 1 result, configured to fail if != 0
[0m17:36:44.930166 [info ] [MainThread]: 
[0m17:36:44.931155 [info ] [MainThread]:   compiled code at target\compiled\Astrafy\models\example\schema.yml\not_null_my_first_dbt_model_id.sql
[0m17:36:44.933151 [info ] [MainThread]: 
[0m17:36:44.936144 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=1 SKIP=3 NO-OP=0 TOTAL=14
[0m17:36:44.939136 [debug] [MainThread]: Command `dbt build` failed at 17:36:44.939136 after 42.13 seconds
[0m17:36:44.940267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE463EB8B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE47E212B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CE5BB186D0>]}
[0m17:36:44.940267 [debug] [MainThread]: Flushing usage events
[0m17:36:45.589600 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:40:23.786263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEDED0B9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEE0FC1B50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEE0FC1D90>]}


============================== 17:40:23.793308 | 630f24c1-c7db-4e36-b746-10a682d28690 ==============================
[0m17:40:23.793308 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m17:40:23.795301 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'no_print': 'None', 'partial_parse': 'True', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'invocation_command': 'dbt build', 'log_format': 'default', 'write_json': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m17:40:28.770297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEF3F7EDC0>]}
[0m17:40:28.879167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEE0899BE0>]}
[0m17:40:28.879167 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m17:40:30.002608 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m17:40:30.453670 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 0 files added, 0 files changed.
[0m17:40:30.453670 [debug] [MainThread]: Partial parsing: deleted file: Astrafy://models\example\my_second_dbt_model.sql
[0m17:40:30.453670 [debug] [MainThread]: Partial parsing: deleted file: Astrafy://models\example\my_first_dbt_model.sql
[0m17:40:30.625942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEF471CEE0>]}
[0m17:40:30.781573 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m17:40:30.781573 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m17:40:30.851869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEF47316D0>]}
[0m17:40:30.851869 [info ] [MainThread]: Found 8 models, 2 sources, 508 macros
[0m17:40:30.851869 [info ] [MainThread]: 
[0m17:40:30.851869 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:40:30.851869 [info ] [MainThread]: 
[0m17:40:30.863741 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:40:30.872731 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m17:40:30.873728 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:40:31.395843 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:40:31.921594 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy_staging'
[0m17:40:31.937168 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:40:32.437521 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_staging, now list_sage-tribute-474816-g2_Astrafy_marts)
[0m17:40:32.437521 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:40:32.948880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEDD3697C0>]}
[0m17:40:32.951833 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:40:32.969879 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_orders
[0m17:40:32.969879 [info ] [Thread-1  ]: 1 of 8 START sql view model Astrafy_staging.stg_orders ......................... [RUN]
[0m17:40:32.969879 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.stg_orders'
[0m17:40:32.969879 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_orders
[0m17:40:33.019088 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_orders"
[0m17:40:33.025072 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_orders
[0m17:40:33.055063 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_orders"
[0m17:40:33.071894 [debug] [Thread-1  ]: On model.Astrafy.stg_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_orders"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
  OPTIONS(
      description="""Cleaned and normalized orders table."""
    )
  as 

-- Clean and normalize the orders table
select
  date_date,
  cast(customers_id as int64) as customer_id,
  cast(orders_id as int64) as order_id,
  cast(net_sales as float64) as net_sales
from `sage-tribute-474816-g2`.`Astrafy`.`orders_recrutement`
where date_date is not null;


[0m17:40:33.072890 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:40:33.921369 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:ba1db78c-079a-4aeb-8a08-4da94c7bdcff&page=queryresults
[0m17:40:34.830762 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEEDEEEBB0>]}
[0m17:40:34.834489 [info ] [Thread-1  ]: 1 of 8 OK created sql view model Astrafy_staging.stg_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.86s]
[0m17:40:34.836455 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_orders
[0m17:40:34.838743 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_sales
[0m17:40:34.840742 [info ] [Thread-1  ]: 2 of 8 START sql view model Astrafy_staging.stg_sales .......................... [RUN]
[0m17:40:34.842865 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_orders, now model.Astrafy.stg_sales)
[0m17:40:34.844860 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_sales
[0m17:40:34.857704 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_sales"
[0m17:40:34.857704 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_sales
[0m17:40:34.869491 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_sales"
[0m17:40:34.869491 [debug] [Thread-1  ]: On model.Astrafy.stg_sales: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_sales"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  OPTIONS(
      description="""Cleaned and normalized sales table with product-level details."""
    )
  as 

-- Clean and normalize the sales table
select
  date_date,
  cast(customer_id as int64) as customer_id,
  cast(order_id as int64) as order_id,
  cast(products_id as int64) as product_id,
  cast(net_sales as float64) as net_sales,
  cast(qty as int64) as qty
from `sage-tribute-474816-g2`.`Astrafy`.`sales_recrutement`
where date_date is not null;


[0m17:40:34.869491 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:40:35.689088 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:bfafb922-6f23-40ac-82b5-9e8fad9726c7&page=queryresults
[0m17:40:36.385253 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEF4959D90>]}
[0m17:40:36.400592 [info ] [Thread-1  ]: 2 of 8 OK created sql view model Astrafy_staging.stg_sales ..................... [[32mCREATE VIEW (0 processed)[0m in 1.54s]
[0m17:40:36.401960 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_sales
[0m17:40:36.401960 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_1_total_orders
[0m17:40:36.401960 [info ] [Thread-1  ]: 3 of 8 START sql table model Astrafy_marts.ex_1_total_orders ................... [RUN]
[0m17:40:36.401960 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_sales, now model.Astrafy.ex_1_total_orders)
[0m17:40:36.419106 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_1_total_orders
[0m17:40:36.423054 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_1_total_orders"
[0m17:40:36.423054 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_1_total_orders
[0m17:40:36.453598 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:40:37.035264 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_1_total_orders"
[0m17:40:37.054331 [debug] [Thread-1  ]: On model.Astrafy.ex_1_total_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_1_total_orders"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_1_total_orders`
      
    
    

    
    OPTIONS(
      description="""Total number of unique orders placed in 2023."""
    )
    as (
      

-- Total number of unique orders placed in 2023
select
  count(distinct order_id) as total_orders_2023
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
    );
  
[0m17:40:37.815138 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:dde756c4-6c02-4ce8-8f18-0d6afd36b307&page=queryresults
[0m17:40:39.769355 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEF49D1430>]}
[0m17:40:39.774340 [info ] [Thread-1  ]: 3 of 8 OK created sql table model Astrafy_marts.ex_1_total_orders .............. [[32mCREATE TABLE (1.0 rows, 57.2 KiB processed)[0m in 3.37s]
[0m17:40:39.779833 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_1_total_orders
[0m17:40:39.781830 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_2_orders_per_month
[0m17:40:39.781830 [info ] [Thread-1  ]: 4 of 8 START sql table model Astrafy_marts.ex_2_orders_per_month ............... [RUN]
[0m17:40:39.786278 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_1_total_orders, now model.Astrafy.ex_2_orders_per_month)
[0m17:40:39.789269 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_2_orders_per_month
[0m17:40:39.799242 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_2_orders_per_month"
[0m17:40:39.804317 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_2_orders_per_month
[0m17:40:39.804317 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:40:40.270678 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_2_orders_per_month"
[0m17:40:40.271239 [debug] [Thread-1  ]: On model.Astrafy.ex_2_orders_per_month: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_2_orders_per_month"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_2_orders_per_month`
      
    
    

    
    OPTIONS(
      description="""Monthly order volume for 2023."""
    )
    as (
      

-- Monthly order count for 2023
select
  extract(year from date_date) as year,
  extract(month from date_date) as month,
  count(distinct order_id) as orders_per_month
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
group by 1, 2
order by year, month
    );
  
[0m17:40:41.516150 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:9a712333-5490-4b5e-82b5-5f26375fc5f9&page=queryresults
[0m17:40:43.572103 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEF48E3130>]}
[0m17:40:43.572103 [info ] [Thread-1  ]: 4 of 8 OK created sql table model Astrafy_marts.ex_2_orders_per_month .......... [[32mCREATE TABLE (12.0 rows, 57.2 KiB processed)[0m in 3.79s]
[0m17:40:43.587743 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_2_orders_per_month
[0m17:40:43.587743 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_5_order_segmentation
[0m17:40:43.587743 [info ] [Thread-1  ]: 5 of 8 START sql table model Astrafy_marts.ex_5_order_segmentation ............. [RUN]
[0m17:40:43.605082 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_2_orders_per_month, now model.Astrafy.ex_5_order_segmentation)
[0m17:40:43.610612 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_5_order_segmentation
[0m17:40:43.626688 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_5_order_segmentation"
[0m17:40:43.642225 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_5_order_segmentation
[0m17:40:43.642225 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:40:44.261022 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_5_order_segmentation"
[0m17:40:44.279192 [debug] [Thread-1  ]: On model.Astrafy.ex_5_order_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_5_order_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation`
      
    
    

    
    OPTIONS(
      description="""Customer segmentation: New / Returning / VIP for 2023."""
    )
    as (
      

-- Customer segmentation based on number of orders in the past 12 months
with customer_orders as (
    select
        customer_id,
        order_id,
        date_date,
        (
            select count(*)
            from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o2
            where o2.customer_id = o1.customer_id
              and o2.date_date between date_sub(o1.date_date, interval 12 month) and o1.date_date
        ) as orders_last_12m
    from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o1
    where extract(year from date_date) = 2023
)
select
    customer_id,
    order_id,
    date_date,
    case
        when orders_last_12m = 1 then 'New'
        when orders_last_12m between 2 and 4 then 'Returning'
        when orders_last_12m >= 5 then 'VIP'
    end as order_segment
from customer_orders
    );
  
[0m17:40:45.066688 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:2941ed59-e2c0-421c-b5da-e5a574163b8c&page=queryresults
[0m17:40:47.219115 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEF4E6FCD0>]}
[0m17:40:47.219115 [info ] [Thread-1  ]: 5 of 8 OK created sql table model Astrafy_marts.ex_5_order_segmentation ........ [[32mCREATE TABLE (2.6k rows, 85.8 KiB processed)[0m in 3.62s]
[0m17:40:47.219115 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_5_order_segmentation
[0m17:40:47.219115 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_3_avg_products_per_order
[0m17:40:47.234697 [info ] [Thread-1  ]: 6 of 8 START sql table model Astrafy_marts.ex_3_avg_products_per_order ......... [RUN]
[0m17:40:47.236894 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_5_order_segmentation, now model.Astrafy.ex_3_avg_products_per_order)
[0m17:40:47.238006 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_3_avg_products_per_order
[0m17:40:47.245735 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_3_avg_products_per_order"
[0m17:40:47.245735 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_3_avg_products_per_order
[0m17:40:47.245735 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:40:47.696778 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_3_avg_products_per_order"
[0m17:40:47.701767 [debug] [Thread-1  ]: On model.Astrafy.ex_3_avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_3_avg_products_per_order"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_3_avg_products_per_order`
      
    
    

    
    OPTIONS(
      description="""Average number of products per order for each month in 2023."""
    )
    as (
      

-- Average number of products per order for each month in 2023
with products_per_order as (
  select
    order_id,
    count(distinct product_id) as product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  where extract(year from date_date) = 2023
  group by order_id
),
orders_monthly as (
  select
    extract(month from s.date_date) as month,
    p.product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales` s
  join products_per_order p using (order_id)
  where extract(year from s.date_date) = 2023
)
select
  month,
  avg(product_count) as avg_products_per_order
from orders_monthly
group by month
order by month
    );
  
[0m17:40:48.379666 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:77544af9-7494-458d-86c4-0c7c4ebab916&page=queryresults
[0m17:40:50.480954 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEF49D1A00>]}
[0m17:40:50.480954 [info ] [Thread-1  ]: 6 of 8 OK created sql table model Astrafy_marts.ex_3_avg_products_per_order .... [[32mCREATE TABLE (12.0 rows, 664.7 KiB processed)[0m in 3.25s]
[0m17:40:50.480954 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_3_avg_products_per_order
[0m17:40:50.496629 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_4_orders_with_qty
[0m17:40:50.499538 [info ] [Thread-1  ]: 7 of 8 START sql table model Astrafy_marts.ex_4_orders_with_qty ................ [RUN]
[0m17:40:50.500859 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_3_avg_products_per_order, now model.Astrafy.ex_4_orders_with_qty)
[0m17:40:50.500859 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_4_orders_with_qty
[0m17:40:50.517615 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_4_orders_with_qty"
[0m17:40:50.519278 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_4_orders_with_qty
[0m17:40:50.519278 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:40:51.071422 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_4_orders_with_qty"
[0m17:40:51.076376 [debug] [Thread-1  ]: On model.Astrafy.ex_4_orders_with_qty: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_4_orders_with_qty"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_4_orders_with_qty`
      
    
    

    
    OPTIONS(
      description="""Orders for 2022\u20132023 with total quantity of products per order."""
    )
    as (
      

-- Orders (2022–2023) with total quantity of products per order
with product_counts as (
    select
        order_id,
        sum(qty) as qty_product
    from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
    where extract(year from date_date) in (2022, 2023)
    group by order_id
)
select
    o.date_date,
    o.customer_id,
    o.order_id,
    o.net_sales,
    p.qty_product
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o
left join product_counts p using (order_id)
where extract(year from o.date_date) in (2022, 2023)
    );
  
[0m17:40:51.807571 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:712e2b6e-6975-4a55-a7f5-7a6f907a5036&page=queryresults
[0m17:40:53.747259 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEF4D810A0>]}
[0m17:40:53.747259 [info ] [Thread-1  ]: 7 of 8 OK created sql table model Astrafy_marts.ex_4_orders_with_qty ........... [[32mCREATE TABLE (3.7k rows, 779.1 KiB processed)[0m in 3.25s]
[0m17:40:53.765192 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_4_orders_with_qty
[0m17:40:53.766188 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m17:40:53.769181 [info ] [Thread-1  ]: 8 of 8 START sql table model Astrafy_marts.ex_6_orders_2023_with_segmentation .. [RUN]
[0m17:40:53.772525 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_4_orders_with_qty, now model.Astrafy.ex_6_orders_2023_with_segmentation)
[0m17:40:53.775515 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m17:40:53.789649 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_6_orders_2023_with_segmentation"
[0m17:40:53.795097 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m17:40:53.797157 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:40:54.287100 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_6_orders_2023_with_segmentation"
[0m17:40:54.305129 [debug] [Thread-1  ]: On model.Astrafy.ex_6_orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_6_orders_2023_with_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_6_orders_2023_with_segmentation`
      
    
    

    
    OPTIONS(
      description="""Final 2023 orders table enriched with segmentation."""
    )
    as (
      

-- 2023 orders with customer segmentation
select
    o.date_date,
    o.customer_id,
    o.order_id,
    o.net_sales,
    s.order_segment
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o
left join `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation` s
    using (order_id, customer_id)
where extract(year from o.date_date) = 2023
    );
  
[0m17:40:54.954871 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:facc59a5-ce3b-414b-ad3f-75a6fa6c8916&page=queryresults
[0m17:40:56.922456 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630f24c1-c7db-4e36-b746-10a682d28690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEF4D6B730>]}
[0m17:40:56.922456 [info ] [Thread-1  ]: 8 of 8 OK created sql table model Astrafy_marts.ex_6_orders_2023_with_segmentation  [[32mCREATE TABLE (2.6k rows, 171.9 KiB processed)[0m in 3.15s]
[0m17:40:56.938067 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m17:40:56.938067 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:40:56.961686 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:40:56.961686 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2' was properly closed.
[0m17:40:56.961686 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy_marts' was properly closed.
[0m17:40:56.974429 [debug] [MainThread]: Connection 'model.Astrafy.ex_6_orders_2023_with_segmentation' was properly closed.
[0m17:40:56.977427 [info ] [MainThread]: 
[0m17:40:56.978736 [info ] [MainThread]: Finished running 6 table models, 2 view models in 0 hours 0 minutes and 26.11 seconds (26.11s).
[0m17:40:56.992762 [debug] [MainThread]: Command end result
[0m17:40:57.056215 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m17:40:57.056325 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m17:40:57.073231 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m17:40:57.073231 [info ] [MainThread]: 
[0m17:40:57.073231 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:40:57.073231 [info ] [MainThread]: 
[0m17:40:57.073231 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=8
[0m17:40:57.073231 [debug] [MainThread]: Command `dbt build` succeeded at 17:40:57.073231 after 33.44 seconds
[0m17:40:57.073231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEDED0B9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEE00DF130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002CEE0899BE0>]}
[0m17:40:57.088605 [debug] [MainThread]: Flushing usage events
[0m17:40:57.674074 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:50:39.981438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E484A9B910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E486D44340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E486D440D0>]}


============================== 21:50:39.990652 | 60f8983d-307b-47c5-8c7a-4496a78972b1 ==============================
[0m21:50:39.990652 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m21:50:39.992675 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'no_print': 'None', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'invocation_command': 'dbt debug', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'None', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:50:40.053556 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m21:50:40.054556 [info ] [MainThread]: python version: 3.9.13
[0m21:50:40.056320 [info ] [MainThread]: python path: C:\bigquery\dbt-core\Scripts\python.exe
[0m21:50:40.057318 [info ] [MainThread]: os info: Windows-10-10.0.19045-SP0
[0m21:50:49.790836 [info ] [MainThread]: Using profiles dir at C:\Users\perez\.dbt
[0m21:50:49.790836 [info ] [MainThread]: Using profiles.yml file at C:\Users\perez\.dbt\profiles.yml
[0m21:50:49.790836 [info ] [MainThread]: Using dbt_project.yml file at C:\bigquery\dbt-core\Astrafy\dbt_project.yml
[0m21:50:49.790836 [info ] [MainThread]: adapter type: bigquery
[0m21:50:49.790836 [info ] [MainThread]: adapter version: 1.10.2
[0m21:50:49.979131 [info ] [MainThread]: Configuration:
[0m21:50:49.979131 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m21:50:49.979131 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m21:50:49.979131 [info ] [MainThread]: Required dependencies:
[0m21:50:49.979131 [debug] [MainThread]: Executing "git --help"
[0m21:50:50.067775 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m21:50:50.068803 [debug] [MainThread]: STDERR: "b''"
[0m21:50:50.069802 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m21:50:50.070795 [info ] [MainThread]: Connection:
[0m21:50:50.072761 [info ] [MainThread]:   method: service-account
[0m21:50:50.073757 [info ] [MainThread]:   database: sage-tribute-474816-g2
[0m21:50:50.074755 [info ] [MainThread]:   execution_project: sage-tribute-474816-g2
[0m21:50:50.076750 [info ] [MainThread]:   schema: Astrafy
[0m21:50:50.078746 [info ] [MainThread]:   location: EU
[0m21:50:50.079742 [info ] [MainThread]:   priority: interactive
[0m21:50:50.082734 [info ] [MainThread]:   maximum_bytes_billed: None
[0m21:50:50.084730 [info ] [MainThread]:   impersonate_service_account: None
[0m21:50:50.086723 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m21:50:50.087918 [info ] [MainThread]:   job_retries: 1
[0m21:50:50.087918 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m21:50:50.087918 [info ] [MainThread]:   job_execution_timeout_seconds: 200
[0m21:50:50.087918 [info ] [MainThread]:   timeout_seconds: 200
[0m21:50:50.087918 [info ] [MainThread]:   client_id: None
[0m21:50:50.087918 [info ] [MainThread]:   token_uri: None
[0m21:50:50.099897 [info ] [MainThread]:   compute_region: None
[0m21:50:50.099897 [info ] [MainThread]:   dataproc_cluster_name: None
[0m21:50:50.099897 [info ] [MainThread]:   gcs_bucket: None
[0m21:50:50.099897 [info ] [MainThread]:   dataproc_batch: None
[0m21:50:50.099897 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:50:51.197064 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m21:50:51.197064 [debug] [MainThread]: On debug: select 1 as id
[0m21:50:51.212686 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:50:52.050455 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:7f82a74b-67de-43e8-9dec-cab3879120bf&page=queryresults
[0m21:50:52.743376 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m21:50:52.743376 [info ] [MainThread]: [32mAll checks passed![0m
[0m21:50:52.765047 [debug] [MainThread]: Command `dbt debug` succeeded at 21:50:52.764157 after 12.92 seconds
[0m21:50:52.768041 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m21:50:52.771302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E484A9B910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E499D949A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E499DEC610>]}
[0m21:50:52.775608 [debug] [MainThread]: Flushing usage events
[0m21:50:53.337383 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:51:57.390596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026145E8B970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026148141FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026148141D60>]}


============================== 21:51:57.390596 | 0f6c69a5-23f9-4493-b13b-abd8322c3b99 ==============================
[0m21:51:57.390596 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m21:51:57.400612 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'no_print': 'None', 'use_experimental_parser': 'False', 'profiles_dir': 'C:\\Users\\perez\\.dbt', 'log_path': 'C:\\bigquery\\dbt-core\\Astrafy\\logs', 'invocation_command': 'dbt build', 'write_json': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m21:52:01.947487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000261480FF370>]}
[0m21:52:02.041678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615B29E820>]}
[0m21:52:02.041678 [info ] [MainThread]: Registered adapter: bigquery=1.10.2
[0m21:52:03.256502 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m21:52:03.709206 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 2 files added, 8 files changed.
[0m21:52:03.710205 [debug] [MainThread]: Partial parsing: added file: Astrafy://models\staging\staging_schema.yml
[0m21:52:03.711199 [debug] [MainThread]: Partial parsing: added file: Astrafy://models\marts\marts_schema.yml
[0m21:52:03.713196 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\ex_5_order_segmentation.sql
[0m21:52:03.714193 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\ex_2_orders_per_month.sql
[0m21:52:03.715169 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\ex_3_avg_products_per_order.sql
[0m21:52:03.716156 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\staging\stg_orders.sql
[0m21:52:03.717152 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\ex_4_orders_with_qty.sql
[0m21:52:03.717152 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\staging\stg_sales.sql
[0m21:52:03.718182 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\ex_6_orders_2023_with_segmentation.sql
[0m21:52:03.719148 [debug] [MainThread]: Partial parsing: updated file: Astrafy://models\marts\ex_1_total_orders.sql
[0m21:52:04.588425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615BBBB130>]}
[0m21:52:04.744204 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m21:52:04.759793 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m21:52:04.843784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615BBD60A0>]}
[0m21:52:04.843784 [info ] [MainThread]: Found 8 models, 2 sources, 508 macros
[0m21:52:04.852497 [info ] [MainThread]: 
[0m21:52:04.855019 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:52:04.859811 [info ] [MainThread]: 
[0m21:52:04.866414 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:52:04.882304 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2'
[0m21:52:04.882304 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:52:05.399988 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:52:05.906689 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sage-tribute-474816-g2_Astrafy_marts'
[0m21:52:05.911683 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:52:06.491493 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sage-tribute-474816-g2_Astrafy_marts, now list_sage-tribute-474816-g2_Astrafy_staging)
[0m21:52:06.496479 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:52:07.040468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000261480CB3A0>]}
[0m21:52:07.040468 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:52:07.071670 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_orders
[0m21:52:07.071670 [info ] [Thread-1  ]: 1 of 8 START sql view model Astrafy_staging.stg_orders ......................... [RUN]
[0m21:52:07.071670 [debug] [Thread-1  ]: Acquiring new bigquery connection 'model.Astrafy.stg_orders'
[0m21:52:07.071670 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_orders
[0m21:52:07.099062 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_orders"
[0m21:52:07.111834 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_orders
[0m21:52:07.160772 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_orders"
[0m21:52:07.160772 [debug] [Thread-1  ]: On model.Astrafy.stg_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_orders"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
  OPTIONS(
      description="""Staging view for orders. Casts types and excludes null dates."""
    )
  as 

-- STG: orders
-- Purpose: Normalize and type-cast raw orders_recrutement source.
-- Notes: keep minimal transformations here (type casting, null filtering).
select
  date_date,                                  -- source date column (kept as date)
  cast(customers_id as int64) as customer_id, -- normalize to int64
  cast(orders_id as int64) as order_id,       -- normalize to int64
  cast(net_sales as float64) as net_sales     -- normalize to numeric
from `sage-tribute-474816-g2`.`Astrafy`.`orders_recrutement`
where date_date is not null                    -- safety: exclude rows without date;


[0m21:52:07.160772 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m21:52:07.946600 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:03f4da3e-2f38-47fb-b896-56b023cd2e57&page=queryresults
[0m21:52:09.109794 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615B968F40>]}
[0m21:52:09.109794 [info ] [Thread-1  ]: 1 of 8 OK created sql view model Astrafy_staging.stg_orders .................... [[32mCREATE VIEW (0 processed)[0m in 2.04s]
[0m21:52:09.125413 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_orders
[0m21:52:09.125413 [debug] [Thread-1  ]: Began running node model.Astrafy.stg_sales
[0m21:52:09.125413 [info ] [Thread-1  ]: 2 of 8 START sql view model Astrafy_staging.stg_sales .......................... [RUN]
[0m21:52:09.152036 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_orders, now model.Astrafy.stg_sales)
[0m21:52:09.180457 [debug] [Thread-1  ]: Began compiling node model.Astrafy.stg_sales
[0m21:52:09.186968 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.stg_sales"
[0m21:52:09.245198 [debug] [Thread-1  ]: Began executing node model.Astrafy.stg_sales
[0m21:52:09.267691 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.stg_sales"
[0m21:52:09.276669 [debug] [Thread-1  ]: On model.Astrafy.stg_sales: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.stg_sales"} */


  create or replace view `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  OPTIONS(
      description="""Staging view for sales lines. Product-level granularity and typed columns."""
    )
  as 

-- STG: sales
-- Purpose: Normalize raw sales_recrutement and provide product-level lines.
-- Keep transformations minimal: cast types, remove null dates.
select
  date_date,
  cast(customer_id as int64) as customer_id,
  cast(order_id as int64) as order_id,
  cast(products_id as int64) as product_id,
  cast(net_sales as float64) as net_sales,
  cast(qty as int64) as qty
from `sage-tribute-474816-g2`.`Astrafy`.`sales_recrutement`
where date_date is not null;


[0m21:52:09.278685 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:52:10.080996 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:22d33d16-704b-4a99-89f3-a575711e4f69&page=queryresults
[0m21:52:10.813371 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615B968F40>]}
[0m21:52:10.829045 [info ] [Thread-1  ]: 2 of 8 OK created sql view model Astrafy_staging.stg_sales ..................... [[32mCREATE VIEW (0 processed)[0m in 1.66s]
[0m21:52:10.829045 [debug] [Thread-1  ]: Finished running node model.Astrafy.stg_sales
[0m21:52:10.847033 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_1_total_orders
[0m21:52:10.851011 [info ] [Thread-1  ]: 3 of 8 START sql table model Astrafy_marts.ex_1_total_orders ................... [RUN]
[0m21:52:10.854092 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.stg_sales, now model.Astrafy.ex_1_total_orders)
[0m21:52:10.854092 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_1_total_orders
[0m21:52:10.869717 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_1_total_orders"
[0m21:52:10.869717 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_1_total_orders
[0m21:52:10.897317 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:52:11.389006 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_1_total_orders"
[0m21:52:11.399817 [debug] [Thread-1  ]: On model.Astrafy.ex_1_total_orders: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_1_total_orders"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_1_total_orders`
      
    
    

    
    OPTIONS(
      description="""Total unique orders in 2023. Useful for high-level KPI."""
    )
    as (
      

-- EX 1: Total number of unique orders in 2023
-- Returns a single-row table for easy consumption by dashboards/tests.
select
  count(distinct order_id) as total_orders_2023
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
    );
  
[0m21:52:12.066390 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:f2aa5284-44b4-486d-8d6f-f217c5eb4423&page=queryresults
[0m21:52:14.150702 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615B22DCA0>]}
[0m21:52:14.150702 [info ] [Thread-1  ]: 3 of 8 OK created sql table model Astrafy_marts.ex_1_total_orders .............. [[32mCREATE TABLE (1.0 rows, 57.2 KiB processed)[0m in 3.28s]
[0m21:52:14.150702 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_1_total_orders
[0m21:52:14.170673 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_2_orders_per_month
[0m21:52:14.173661 [info ] [Thread-1  ]: 4 of 8 START sql table model Astrafy_marts.ex_2_orders_per_month ............... [RUN]
[0m21:52:14.177931 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_1_total_orders, now model.Astrafy.ex_2_orders_per_month)
[0m21:52:14.180923 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_2_orders_per_month
[0m21:52:14.200781 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_2_orders_per_month"
[0m21:52:14.200781 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_2_orders_per_month
[0m21:52:14.200781 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:52:14.635123 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_2_orders_per_month"
[0m21:52:14.650744 [debug] [Thread-1  ]: On model.Astrafy.ex_2_orders_per_month: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_2_orders_per_month"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_2_orders_per_month`
      
    
    

    
    OPTIONS(
      description="""Monthly orders and revenue for 2023. Good for trend analysis."""
    )
    as (
      

-- EX 2: Orders per month in 2023 + revenue
-- month is returned as yyyy-mm string for easy labeling in visualizations.
select
  format_date('%Y-%m', date_date) as month,
  count(distinct order_id) as orders_per_month,
  sum(net_sales) as revenue_per_month
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders`
where extract(year from date_date) = 2023
group by 1
order by 1
    );
  
[0m21:52:15.457850 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:72c986ca-a9c8-4fec-80ed-8b3d7ffa4a71&page=queryresults
[0m21:52:18.437558 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615BA8A220>]}
[0m21:52:18.437558 [info ] [Thread-1  ]: 4 of 8 OK created sql table model Astrafy_marts.ex_2_orders_per_month .......... [[32mCREATE TABLE (12.0 rows, 85.8 KiB processed)[0m in 4.26s]
[0m21:52:18.437558 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_2_orders_per_month
[0m21:52:18.437558 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_5_order_segmentation
[0m21:52:18.437558 [info ] [Thread-1  ]: 5 of 8 START sql table model Astrafy_marts.ex_5_order_segmentation ............. [RUN]
[0m21:52:18.453182 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_2_orders_per_month, now model.Astrafy.ex_5_order_segmentation)
[0m21:52:18.455470 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_5_order_segmentation
[0m21:52:18.457263 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_5_order_segmentation"
[0m21:52:18.474037 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_5_order_segmentation
[0m21:52:18.477394 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:52:18.931707 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_5_order_segmentation"
[0m21:52:18.955633 [debug] [Thread-1  ]: On model.Astrafy.ex_5_order_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_5_order_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation`
      
    
    

    
    OPTIONS(
      description="""Customer order segmentation (New / Returning / VIP) calculated using 12-month lookback."""
    )
    as (
      

-- EX 5: Customer segmentation for each order in 2023
-- Segments:
--  - New: only 1 order in the last 12 months (including current)
--  - Returning: 2-4 orders in the last 12 months
--  - VIP: 5+ orders in the last 12 months
--
-- Implementation notes:
--  - BigQuery does not allow RANGE BETWEEN '12 months' on DATE in the same way as numeric offsets.
--  - Use a correlated subquery to count orders for the same customer within [order_date - 12 months, order_date].
--  - This approach is clear and correct for dataset sizes used in take-home challenges.
with orders_in_2023 as (
  select
    o1.customer_id,
    o1.order_id,
    o1.date_date,
    (
      select count(*)
      from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o2
      where o2.customer_id = o1.customer_id
        and o2.date_date between date_sub(o1.date_date, interval 12 month) and o1.date_date
    ) as orders_last_12m
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o1
  where extract(year from o1.date_date) = 2023
)
select
  customer_id,
  order_id,
  date_date,
  case
    when orders_last_12m = 1 then 'New'
    when orders_last_12m between 2 and 4 then 'Returning'
    when orders_last_12m >= 5 then 'VIP'
    else 'Unknown'
  end as order_segment
from orders_in_2023
    );
  
[0m21:52:19.672656 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:c1fc35ea-3760-4c7e-8b46-e61b9a2e7cd5&page=queryresults
[0m21:52:21.651427 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615B9FDAF0>]}
[0m21:52:21.657409 [info ] [Thread-1  ]: 5 of 8 OK created sql table model Astrafy_marts.ex_5_order_segmentation ........ [[32mCREATE TABLE (2.6k rows, 85.8 KiB processed)[0m in 3.20s]
[0m21:52:21.665386 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_5_order_segmentation
[0m21:52:21.669374 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_3_avg_products_per_order
[0m21:52:21.672370 [info ] [Thread-1  ]: 6 of 8 START sql table model Astrafy_marts.ex_3_avg_products_per_order ......... [RUN]
[0m21:52:21.675362 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_5_order_segmentation, now model.Astrafy.ex_3_avg_products_per_order)
[0m21:52:21.677518 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_3_avg_products_per_order
[0m21:52:21.691740 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_3_avg_products_per_order"
[0m21:52:21.708415 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_3_avg_products_per_order
[0m21:52:21.708415 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:52:22.181673 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_3_avg_products_per_order"
[0m21:52:22.197156 [debug] [Thread-1  ]: On model.Astrafy.ex_3_avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_3_avg_products_per_order"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_3_avg_products_per_order`
      
    
    

    
    OPTIONS(
      description="""Average number of distinct products per order (monthly)."""
    )
    as (
      

-- EX 3: Average number of distinct products per order (monthly)
-- Approach:
-- 1) count distinct product_id per order (product count per order)
-- 2) join to orders to associate month and compute average per month
with products_per_order as (
  select
    order_id,
    count(distinct product_id) as product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  where extract(year from date_date) = 2023
  group by order_id
),
orders_with_month as (
  select
    o.order_id,
    format_date('%Y-%m', o.date_date) as month,
    p.product_count
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o
  join products_per_order p using (order_id)
  where extract(year from o.date_date) = 2023
)
select
  month,
  avg(product_count) as avg_products_per_order
from orders_with_month
group by month
order by month
    );
  
[0m21:52:23.028105 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:d5ea33db-7998-4c55-912b-acdd10e5d627&page=queryresults
[0m21:52:25.361356 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615B303A00>]}
[0m21:52:25.366343 [info ] [Thread-1  ]: 6 of 8 OK created sql table model Astrafy_marts.ex_3_avg_products_per_order .... [[32mCREATE TABLE (12.0 rows, 721.9 KiB processed)[0m in 3.69s]
[0m21:52:25.369320 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_3_avg_products_per_order
[0m21:52:25.371270 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_4_orders_with_qty
[0m21:52:25.373266 [info ] [Thread-1  ]: 7 of 8 START sql table model Astrafy_marts.ex_4_orders_with_qty ................ [RUN]
[0m21:52:25.377255 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_3_avg_products_per_order, now model.Astrafy.ex_4_orders_with_qty)
[0m21:52:25.380247 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_4_orders_with_qty
[0m21:52:25.389121 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_4_orders_with_qty"
[0m21:52:25.396649 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_4_orders_with_qty
[0m21:52:25.396649 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:52:26.180000 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_4_orders_with_qty"
[0m21:52:26.180000 [debug] [Thread-1  ]: On model.Astrafy.ex_4_orders_with_qty: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_4_orders_with_qty"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_4_orders_with_qty`
      
    
    

    
    OPTIONS(
      description="""Orders with total quantity of products and aggregated sales lines."""
    )
    as (
      

-- EX 4: One row per order with total product quantity (qty_product)
-- We aggregate sales lines per order to compute total qty and total line_sales.
with agg as (
  select
    order_id,
    sum(qty) as qty_product,
    sum(net_sales) as sales_from_lines
  from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_sales`
  where extract(year from date_date) in (2022, 2023)
  group by order_id
)
select
  o.date_date,
  o.customer_id,
  o.order_id,
  o.net_sales as order_net_sales,   -- reported net sales at order-level
  coalesce(a.qty_product, 0) as qty_product,
  coalesce(a.sales_from_lines, 0) as sales_from_lines
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o
left join agg a using (order_id)
where extract(year from o.date_date) in (2022, 2023)
    );
  
[0m21:52:26.962786 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:1f1d4bca-57ad-4c4c-ac15-62dd32a7d10b&page=queryresults
[0m21:52:29.306209 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615B294E50>]}
[0m21:52:29.306209 [info ] [Thread-1  ]: 7 of 8 OK created sql table model Astrafy_marts.ex_4_orders_with_qty ........... [[32mCREATE TABLE (3.7k rows, 1000.7 KiB processed)[0m in 3.93s]
[0m21:52:29.321826 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_4_orders_with_qty
[0m21:52:29.321826 [debug] [Thread-1  ]: Began running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m21:52:29.321826 [info ] [Thread-1  ]: 8 of 8 START sql table model Astrafy_marts.ex_6_orders_2023_with_segmentation .. [RUN]
[0m21:52:29.335168 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.Astrafy.ex_4_orders_with_qty, now model.Astrafy.ex_6_orders_2023_with_segmentation)
[0m21:52:29.338157 [debug] [Thread-1  ]: Began compiling node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m21:52:29.362248 [debug] [Thread-1  ]: Writing injected SQL for node "model.Astrafy.ex_6_orders_2023_with_segmentation"
[0m21:52:29.373391 [debug] [Thread-1  ]: Began executing node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m21:52:29.378397 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m21:52:29.852629 [debug] [Thread-1  ]: Writing runtime sql for node "model.Astrafy.ex_6_orders_2023_with_segmentation"
[0m21:52:29.875002 [debug] [Thread-1  ]: On model.Astrafy.ex_6_orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "Astrafy", "target_name": "dev", "node_id": "model.Astrafy.ex_6_orders_2023_with_segmentation"} */

  
    

    create or replace table `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_6_orders_2023_with_segmentation`
      
    
    

    
    OPTIONS(
      description="""Final enriched orders table for 2023 including order_segment for reporting."""
    )
    as (
      

-- EX 6: Final 2023 orders table with customer segmentation
-- Join staging orders with segmentation table per order.
select
  o.date_date,
  o.customer_id,
  o.order_id,
  o.net_sales,
  s.order_segment
from `sage-tribute-474816-g2`.`Astrafy_staging`.`stg_orders` o
left join `sage-tribute-474816-g2`.`Astrafy_marts`.`ex_5_order_segmentation` s
  using (order_id, customer_id)
where extract(year from o.date_date) = 2023
    );
  
[0m21:52:30.565526 [debug] [Thread-1  ]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sage-tribute-474816-g2&j=bq:EU:b0b6b2d2-3d13-46d5-b7db-274b11f39707&page=queryresults
[0m21:52:32.821636 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0f6c69a5-23f9-4493-b13b-abd8322c3b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615D091B80>]}
[0m21:52:32.837163 [info ] [Thread-1  ]: 8 of 8 OK created sql table model Astrafy_marts.ex_6_orders_2023_with_segmentation  [[32mCREATE TABLE (2.6k rows, 171.9 KiB processed)[0m in 3.50s]
[0m21:52:32.852737 [debug] [Thread-1  ]: Finished running node model.Astrafy.ex_6_orders_2023_with_segmentation
[0m21:52:32.857549 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:52:32.865533 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:52:32.869974 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2' was properly closed.
[0m21:52:32.872963 [debug] [MainThread]: Connection 'list_sage-tribute-474816-g2_Astrafy_staging' was properly closed.
[0m21:52:32.873958 [debug] [MainThread]: Connection 'model.Astrafy.ex_6_orders_2023_with_segmentation' was properly closed.
[0m21:52:32.875954 [info ] [MainThread]: 
[0m21:52:32.876631 [info ] [MainThread]: Finished running 6 table models, 2 view models in 0 hours 0 minutes and 28.01 seconds (28.01s).
[0m21:52:32.876631 [debug] [MainThread]: Command end result
[0m21:52:32.937097 [debug] [MainThread]: Wrote artifact WritableManifest to C:\bigquery\dbt-core\Astrafy\target\manifest.json
[0m21:52:32.937097 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\bigquery\dbt-core\Astrafy\target\semantic_manifest.json
[0m21:52:32.962453 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\bigquery\dbt-core\Astrafy\target\run_results.json
[0m21:52:32.962453 [info ] [MainThread]: 
[0m21:52:32.962453 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:52:32.962453 [info ] [MainThread]: 
[0m21:52:32.970366 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=8
[0m21:52:32.970366 [debug] [MainThread]: Command `dbt build` succeeded at 21:52:32.970366 after 35.73 seconds
[0m21:52:32.970366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026145E8B970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002614722DD30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002615B29E820>]}
[0m21:52:32.970366 [debug] [MainThread]: Flushing usage events
[0m21:52:33.638149 [debug] [MainThread]: An error was encountered while trying to flush usage events
